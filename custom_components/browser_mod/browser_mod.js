const e="undefined"!=typeof globalThis&&globalThis||"undefined"!=typeof self&&self||"undefined"!=typeof global&&global;function t(e,t,i,s){var o,n=arguments.length,r=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(r=(n<3?o(r):n>3?o(t,i,r):o(t,i))||r);return n>3&&r&&Object.defineProperty(t,i,r),r}void 0!==e.EventTarget&&function(e){try{new e}catch(e){return!1}return!0}(e.EventTarget)||(e.EventTarget=function(){function e(){this.__listeners=new Map}return e.prototype=Object.create(Object.prototype),e.prototype.addEventListener=function(e,t,i){if(arguments.length<2)throw new TypeError(`TypeError: Failed to execute 'addEventListener' on 'EventTarget': 2 arguments required, but only ${arguments.length} present.`);const s=this.__listeners,o=e.toString();s.has(o)||s.set(o,new Map);const n=s.get(o);n.has(t)||n.set(t,i)},e.prototype.removeEventListener=function(e,t,i){if(arguments.length<2)throw new TypeError(`TypeError: Failed to execute 'addEventListener' on 'EventTarget': 2 arguments required, but only ${arguments.length} present.`);const s=this.__listeners,o=e.toString();if(s.has(o)){const e=s.get(o);e.has(t)&&e.delete(t)}},e.prototype.dispatchEvent=function(e){if(!(e instanceof Event))throw new TypeError("Failed to execute 'dispatchEvent' on 'EventTarget': parameter 1 is not of type 'Event'.");const t=e.type,i=this.__listeners.get(t);if(i)for(const[t,s]of i.entries()){try{"function"==typeof t?t.call(this,e):t&&"function"==typeof t.handleEvent&&t.handleEvent(e)}catch(e){setTimeout(()=>{throw e})}s&&s.once&&i.delete(t)}return!0},e}()),"function"==typeof SuppressedError&&SuppressedError;const i=globalThis,s=i.ShadowRoot&&(void 0===i.ShadyCSS||i.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,o=Symbol(),n=new WeakMap;let r=class{constructor(e,t,i){if(this._$cssResult$=!0,i!==o)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e,this.t=t}get styleSheet(){let e=this.o;const t=this.t;if(s&&void 0===e){const i=void 0!==t&&1===t.length;i&&(e=n.get(t)),void 0===e&&((this.o=e=new CSSStyleSheet).replaceSync(this.cssText),i&&n.set(t,e))}return e}toString(){return this.cssText}};const a=(e,...t)=>{const i=1===e.length?e[0]:t.reduce((t,i,s)=>t+(e=>{if(!0===e._$cssResult$)return e.cssText;if("number"==typeof e)return e;throw Error("Value passed to 'css' function must be a 'css' function result: "+e+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(i)+e[s+1],e[0]);return new r(i,e,o)},l=s?e=>e:e=>e instanceof CSSStyleSheet?(e=>{let t="";for(const i of e.cssRules)t+=i.cssText;return(e=>new r("string"==typeof e?e:e+"",void 0,o))(t)})(e):e,{is:d,defineProperty:c,getOwnPropertyDescriptor:h,getOwnPropertyNames:u,getOwnPropertySymbols:p,getPrototypeOf:_}=Object,v=globalThis,g=v.trustedTypes,m=g?g.emptyScript:"",b=v.reactiveElementPolyfillSupport,w=(e,t)=>e,f={toAttribute(e,t){switch(t){case Boolean:e=e?m:null;break;case Object:case Array:e=null==e?e:JSON.stringify(e)}return e},fromAttribute(e,t){let i=e;switch(t){case Boolean:i=null!==e;break;case Number:i=null===e?null:Number(e);break;case Object:case Array:try{i=JSON.parse(e)}catch(e){i=null}}return i}},y=(e,t)=>!d(e,t),A={attribute:!0,type:String,converter:f,reflect:!1,useDefault:!1,hasChanged:y};Symbol.metadata??=Symbol("metadata"),v.litPropertyMetadata??=new WeakMap;let E=class extends HTMLElement{static addInitializer(e){this._$Ei(),(this.l??=[]).push(e)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(e,t=A){if(t.state&&(t.attribute=!1),this._$Ei(),this.prototype.hasOwnProperty(e)&&((t=Object.create(t)).wrapped=!0),this.elementProperties.set(e,t),!t.noAccessor){const i=Symbol(),s=this.getPropertyDescriptor(e,i,t);void 0!==s&&c(this.prototype,e,s)}}static getPropertyDescriptor(e,t,i){const{get:s,set:o}=h(this.prototype,e)??{get(){return this[t]},set(e){this[t]=e}};return{get:s,set(t){const n=s?.call(this);o?.call(this,t),this.requestUpdate(e,n,i)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){return this.elementProperties.get(e)??A}static _$Ei(){if(this.hasOwnProperty(w("elementProperties")))return;const e=_(this);e.finalize(),void 0!==e.l&&(this.l=[...e.l]),this.elementProperties=new Map(e.elementProperties)}static finalize(){if(this.hasOwnProperty(w("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(w("properties"))){const e=this.properties,t=[...u(e),...p(e)];for(const i of t)this.createProperty(i,e[i])}const e=this[Symbol.metadata];if(null!==e){const t=litPropertyMetadata.get(e);if(void 0!==t)for(const[e,i]of t)this.elementProperties.set(e,i)}this._$Eh=new Map;for(const[e,t]of this.elementProperties){const i=this._$Eu(e,t);void 0!==i&&this._$Eh.set(i,e)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(e){const t=[];if(Array.isArray(e)){const i=new Set(e.flat(1/0).reverse());for(const e of i)t.unshift(l(e))}else void 0!==e&&t.push(l(e));return t}static _$Eu(e,t){const i=t.attribute;return!1===i?void 0:"string"==typeof i?i:"string"==typeof e?e.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){this._$ES=new Promise(e=>this.enableUpdating=e),this._$AL=new Map,this._$E_(),this.requestUpdate(),this.constructor.l?.forEach(e=>e(this))}addController(e){(this._$EO??=new Set).add(e),void 0!==this.renderRoot&&this.isConnected&&e.hostConnected?.()}removeController(e){this._$EO?.delete(e)}_$E_(){const e=new Map,t=this.constructor.elementProperties;for(const i of t.keys())this.hasOwnProperty(i)&&(e.set(i,this[i]),delete this[i]);e.size>0&&(this._$Ep=e)}createRenderRoot(){const e=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return((e,t)=>{if(s)e.adoptedStyleSheets=t.map(e=>e instanceof CSSStyleSheet?e:e.styleSheet);else for(const s of t){const t=document.createElement("style"),o=i.litNonce;void 0!==o&&t.setAttribute("nonce",o),t.textContent=s.cssText,e.appendChild(t)}})(e,this.constructor.elementStyles),e}connectedCallback(){this.renderRoot??=this.createRenderRoot(),this.enableUpdating(!0),this._$EO?.forEach(e=>e.hostConnected?.())}enableUpdating(e){}disconnectedCallback(){this._$EO?.forEach(e=>e.hostDisconnected?.())}attributeChangedCallback(e,t,i){this._$AK(e,i)}_$ET(e,t){const i=this.constructor.elementProperties.get(e),s=this.constructor._$Eu(e,i);if(void 0!==s&&!0===i.reflect){const o=(void 0!==i.converter?.toAttribute?i.converter:f).toAttribute(t,i.type);this._$Em=e,null==o?this.removeAttribute(s):this.setAttribute(s,o),this._$Em=null}}_$AK(e,t){const i=this.constructor,s=i._$Eh.get(e);if(void 0!==s&&this._$Em!==s){const e=i.getPropertyOptions(s),o="function"==typeof e.converter?{fromAttribute:e.converter}:void 0!==e.converter?.fromAttribute?e.converter:f;this._$Em=s;const n=o.fromAttribute(t,e.type);this[s]=n??this._$Ej?.get(s)??n,this._$Em=null}}requestUpdate(e,t,i){if(void 0!==e){const s=this.constructor,o=this[e];if(i??=s.getPropertyOptions(e),!((i.hasChanged??y)(o,t)||i.useDefault&&i.reflect&&o===this._$Ej?.get(e)&&!this.hasAttribute(s._$Eu(e,i))))return;this.C(e,t,i)}!1===this.isUpdatePending&&(this._$ES=this._$EP())}C(e,t,{useDefault:i,reflect:s,wrapped:o},n){i&&!(this._$Ej??=new Map).has(e)&&(this._$Ej.set(e,n??t??this[e]),!0!==o||void 0!==n)||(this._$AL.has(e)||(this.hasUpdated||i||(t=void 0),this._$AL.set(e,t)),!0===s&&this._$Em!==e&&(this._$Eq??=new Set).add(e))}async _$EP(){this.isUpdatePending=!0;try{await this._$ES}catch(e){Promise.reject(e)}const e=this.scheduleUpdate();return null!=e&&await e,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??=this.createRenderRoot(),this._$Ep){for(const[e,t]of this._$Ep)this[e]=t;this._$Ep=void 0}const e=this.constructor.elementProperties;if(e.size>0)for(const[t,i]of e){const{wrapped:e}=i,s=this[t];!0!==e||this._$AL.has(t)||void 0===s||this.C(t,void 0,i,s)}}let e=!1;const t=this._$AL;try{e=this.shouldUpdate(t),e?(this.willUpdate(t),this._$EO?.forEach(e=>e.hostUpdate?.()),this.update(t)):this._$EM()}catch(t){throw e=!1,this._$EM(),t}e&&this._$AE(t)}willUpdate(e){}_$AE(e){this._$EO?.forEach(e=>e.hostUpdated?.()),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(e)),this.updated(e)}_$EM(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(e){return!0}update(e){this._$Eq&&=this._$Eq.forEach(e=>this._$ET(e,this[e])),this._$EM()}updated(e){}firstUpdated(e){}};E.elementStyles=[],E.shadowRootOptions={mode:"open"},E[w("elementProperties")]=new Map,E[w("finalized")]=new Map,b?.({ReactiveElement:E}),(v.reactiveElementVersions??=[]).push("2.1.1");const $=globalThis,S=$.trustedTypes,C=S?S.createPolicy("lit-html",{createHTML:e=>e}):void 0,x="$lit$",q=`lit$${Math.random().toFixed(9).slice(2)}$`,I="?"+q,M=`<${I}>`,k=document,T=()=>k.createComment(""),P=e=>null===e||"object"!=typeof e&&"function"!=typeof e,O=Array.isArray,j="[ \t\n\f\r]",B=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,R=/-->/g,D=/>/g,L=RegExp(`>|${j}(?:([^\\s"'>=/]+)(${j}*=${j}*(?:[^ \t\n\f\r"'\`<>=]|("|')|))|$)`,"g"),U=/'/g,H=/"/g,N=/^(?:script|style|textarea|title)$/i,Y=(e=>(t,...i)=>({_$litType$:e,strings:t,values:i}))(1),G=Symbol.for("lit-noChange"),V=Symbol.for("lit-nothing"),Q=new WeakMap,z=k.createTreeWalker(k,129);function F(e,t){if(!O(e)||!e.hasOwnProperty("raw"))throw Error("invalid template strings array");return void 0!==C?C.createHTML(t):t}class K{constructor({strings:e,_$litType$:t},i){let s;this.parts=[];let o=0,n=0;const r=e.length-1,a=this.parts,[l,d]=((e,t)=>{const i=e.length-1,s=[];let o,n=2===t?"<svg>":3===t?"<math>":"",r=B;for(let t=0;t<i;t++){const i=e[t];let a,l,d=-1,c=0;for(;c<i.length&&(r.lastIndex=c,l=r.exec(i),null!==l);)c=r.lastIndex,r===B?"!--"===l[1]?r=R:void 0!==l[1]?r=D:void 0!==l[2]?(N.test(l[2])&&(o=RegExp("</"+l[2],"g")),r=L):void 0!==l[3]&&(r=L):r===L?">"===l[0]?(r=o??B,d=-1):void 0===l[1]?d=-2:(d=r.lastIndex-l[2].length,a=l[1],r=void 0===l[3]?L:'"'===l[3]?H:U):r===H||r===U?r=L:r===R||r===D?r=B:(r=L,o=void 0);const h=r===L&&e[t+1].startsWith("/>")?" ":"";n+=r===B?i+M:d>=0?(s.push(a),i.slice(0,d)+x+i.slice(d)+q+h):i+q+(-2===d?t:h)}return[F(e,n+(e[i]||"<?>")+(2===t?"</svg>":3===t?"</math>":"")),s]})(e,t);if(this.el=K.createElement(l,i),z.currentNode=this.el.content,2===t||3===t){const e=this.el.content.firstChild;e.replaceWith(...e.childNodes)}for(;null!==(s=z.nextNode())&&a.length<r;){if(1===s.nodeType){if(s.hasAttributes())for(const e of s.getAttributeNames())if(e.endsWith(x)){const t=d[n++],i=s.getAttribute(e).split(q),r=/([.?@])?(.*)/.exec(t);a.push({type:1,index:o,name:r[2],strings:i,ctor:"."===r[1]?ee:"?"===r[1]?te:"@"===r[1]?ie:X}),s.removeAttribute(e)}else e.startsWith(q)&&(a.push({type:6,index:o}),s.removeAttribute(e));if(N.test(s.tagName)){const e=s.textContent.split(q),t=e.length-1;if(t>0){s.textContent=S?S.emptyScript:"";for(let i=0;i<t;i++)s.append(e[i],T()),z.nextNode(),a.push({type:2,index:++o});s.append(e[t],T())}}}else if(8===s.nodeType)if(s.data===I)a.push({type:2,index:o});else{let e=-1;for(;-1!==(e=s.data.indexOf(q,e+1));)a.push({type:7,index:o}),e+=q.length-1}o++}}static createElement(e,t){const i=k.createElement("template");return i.innerHTML=e,i}}function W(e,t,i=e,s){if(t===G)return t;let o=void 0!==s?i._$Co?.[s]:i._$Cl;const n=P(t)?void 0:t._$litDirective$;return o?.constructor!==n&&(o?._$AO?.(!1),void 0===n?o=void 0:(o=new n(e),o._$AT(e,i,s)),void 0!==s?(i._$Co??=[])[s]=o:i._$Cl=o),void 0!==o&&(t=W(e,o._$AS(e,t.values),o,s)),t}let J=class{constructor(e,t){this._$AV=[],this._$AN=void 0,this._$AD=e,this._$AM=t}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(e){const{el:{content:t},parts:i}=this._$AD,s=(e?.creationScope??k).importNode(t,!0);z.currentNode=s;let o=z.nextNode(),n=0,r=0,a=i[0];for(;void 0!==a;){if(n===a.index){let t;2===a.type?t=new Z(o,o.nextSibling,this,e):1===a.type?t=new a.ctor(o,a.name,a.strings,this,e):6===a.type&&(t=new se(o,this,e)),this._$AV.push(t),a=i[++r]}n!==a?.index&&(o=z.nextNode(),n++)}return z.currentNode=k,s}p(e){let t=0;for(const i of this._$AV)void 0!==i&&(void 0!==i.strings?(i._$AI(e,i,t),t+=i.strings.length-2):i._$AI(e[t])),t++}};class Z{get _$AU(){return this._$AM?._$AU??this._$Cv}constructor(e,t,i,s){this.type=2,this._$AH=V,this._$AN=void 0,this._$AA=e,this._$AB=t,this._$AM=i,this.options=s,this._$Cv=s?.isConnected??!0}get parentNode(){let e=this._$AA.parentNode;const t=this._$AM;return void 0!==t&&11===e?.nodeType&&(e=t.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,t=this){e=W(this,e,t),P(e)?e===V||null==e||""===e?(this._$AH!==V&&this._$AR(),this._$AH=V):e!==this._$AH&&e!==G&&this._(e):void 0!==e._$litType$?this.$(e):void 0!==e.nodeType?this.T(e):(e=>O(e)||"function"==typeof e?.[Symbol.iterator])(e)?this.k(e):this._(e)}O(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}T(e){this._$AH!==e&&(this._$AR(),this._$AH=this.O(e))}_(e){this._$AH!==V&&P(this._$AH)?this._$AA.nextSibling.data=e:this.T(k.createTextNode(e)),this._$AH=e}$(e){const{values:t,_$litType$:i}=e,s="number"==typeof i?this._$AC(e):(void 0===i.el&&(i.el=K.createElement(F(i.h,i.h[0]),this.options)),i);if(this._$AH?._$AD===s)this._$AH.p(t);else{const e=new J(s,this),i=e.u(this.options);e.p(t),this.T(i),this._$AH=e}}_$AC(e){let t=Q.get(e.strings);return void 0===t&&Q.set(e.strings,t=new K(e)),t}k(e){O(this._$AH)||(this._$AH=[],this._$AR());const t=this._$AH;let i,s=0;for(const o of e)s===t.length?t.push(i=new Z(this.O(T()),this.O(T()),this,this.options)):i=t[s],i._$AI(o),s++;s<t.length&&(this._$AR(i&&i._$AB.nextSibling,s),t.length=s)}_$AR(e=this._$AA.nextSibling,t){for(this._$AP?.(!1,!0,t);e!==this._$AB;){const t=e.nextSibling;e.remove(),e=t}}setConnected(e){void 0===this._$AM&&(this._$Cv=e,this._$AP?.(e))}}class X{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(e,t,i,s,o){this.type=1,this._$AH=V,this._$AN=void 0,this.element=e,this.name=t,this._$AM=s,this.options=o,i.length>2||""!==i[0]||""!==i[1]?(this._$AH=Array(i.length-1).fill(new String),this.strings=i):this._$AH=V}_$AI(e,t=this,i,s){const o=this.strings;let n=!1;if(void 0===o)e=W(this,e,t,0),n=!P(e)||e!==this._$AH&&e!==G,n&&(this._$AH=e);else{const s=e;let r,a;for(e=o[0],r=0;r<o.length-1;r++)a=W(this,s[i+r],t,r),a===G&&(a=this._$AH[r]),n||=!P(a)||a!==this._$AH[r],a===V?e=V:e!==V&&(e+=(a??"")+o[r+1]),this._$AH[r]=a}n&&!s&&this.j(e)}j(e){e===V?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,e??"")}}class ee extends X{constructor(){super(...arguments),this.type=3}j(e){this.element[this.name]=e===V?void 0:e}}class te extends X{constructor(){super(...arguments),this.type=4}j(e){this.element.toggleAttribute(this.name,!!e&&e!==V)}}class ie extends X{constructor(e,t,i,s,o){super(e,t,i,s,o),this.type=5}_$AI(e,t=this){if((e=W(this,e,t,0)??V)===G)return;const i=this._$AH,s=e===V&&i!==V||e.capture!==i.capture||e.once!==i.once||e.passive!==i.passive,o=e!==V&&(i===V||s);s&&this.element.removeEventListener(this.name,this,i),o&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){"function"==typeof this._$AH?this._$AH.call(this.options?.host??this.element,e):this._$AH.handleEvent(e)}}class se{constructor(e,t,i){this.element=e,this.type=6,this._$AN=void 0,this._$AM=t,this.options=i}get _$AU(){return this._$AM._$AU}_$AI(e){W(this,e)}}const oe={I:Z},ne=$.litHtmlPolyfillSupport;ne?.(K,Z),($.litHtmlVersions??=[]).push("3.3.1");const re=globalThis;let ae=class extends E{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){const e=super.createRenderRoot();return this.renderOptions.renderBefore??=e.firstChild,e}update(e){const t=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(e),this._$Do=((e,t,i)=>{const s=i?.renderBefore??t;let o=s._$litPart$;if(void 0===o){const e=i?.renderBefore??null;s._$litPart$=o=new Z(t.insertBefore(T(),e),e,void 0,i??{})}return o._$AI(e),o})(t,this.renderRoot,this.renderOptions)}connectedCallback(){super.connectedCallback(),this._$Do?.setConnected(!0)}disconnectedCallback(){super.disconnectedCallback(),this._$Do?.setConnected(!1)}render(){return G}};ae._$litElement$=!0,ae.finalized=!0,re.litElementHydrateSupport?.({LitElement:ae});const le=re.litElementPolyfillSupport;le?.({LitElement:ae}),(re.litElementVersions??=[]).push("4.2.1");const de={attribute:!0,type:String,converter:f,reflect:!1,hasChanged:y},ce=(e=de,t,i)=>{const{kind:s,metadata:o}=i;let n=globalThis.litPropertyMetadata.get(o);if(void 0===n&&globalThis.litPropertyMetadata.set(o,n=new Map),"setter"===s&&((e=Object.create(e)).wrapped=!0),n.set(i.name,e),"accessor"===s){const{name:s}=i;return{set(i){const o=t.get.call(this);t.set.call(this,i),this.requestUpdate(s,o,e)},init(t){return void 0!==t&&this.C(s,void 0,e,t),t}}}if("setter"===s){const{name:s}=i;return function(i){const o=this[s];t.call(this,i),this.requestUpdate(s,o,e)}}throw Error("Unsupported decorator location: "+s)};function he(e){return(t,i)=>"object"==typeof i?ce(e,t,i):((e,t,i)=>{const s=t.hasOwnProperty(i);return t.constructor.createProperty(i,e),s?Object.getOwnPropertyDescriptor(t,i):void 0})(e,t,i)}function ue(e){return he({...e,state:!0,attribute:!1})}const pe=(e,t,i)=>(i.configurable=!0,i.enumerable=!0,Reflect.decorate&&"object"!=typeof t&&Object.defineProperty(e,t,i),i);function _e(e,t){return(t,i,s)=>pe(t,i,{get(){return(t=>t.renderRoot?.querySelector(e)??null)(this)}})}function ve(e){return(t,i)=>pe(t,i,{async get(){return await this.updateComplete,this.renderRoot?.querySelector(e)??null}})}class ge extends ae{setConfig(e){}render(){return Y` <div>Nothing to configure.</div> `}}customElements.get("browser-player-editor")||(customElements.define("browser-player-editor",ge),window.customCards=window.customCards||[],window.customCards.push({type:"browser-player",name:"Browser Player",preview:!0}));class me extends ae{static getConfigElement(){return document.createElement("browser-player-editor")}static getStubConfig(){return{}}_reconnect(){var e;(null===(e=window.browser_mod)||void 0===e?void 0:e.registered)||("hui-card-preview"===this.parentElement.localName?this.removeAttribute("hidden"):this.setAttribute("hidden",""))}async connectedCallback(){var e;super.connectedCallback(),await(null===(e=window.browser_mod)||void 0===e?void 0:e.connectionPromise),this._reconnect()}async setConfig(e){for(var t,i,s,o,n;!window.browser_mod;)await new Promise(e=>setTimeout(e,1e3));for(const e of["play","pause","ended","volumechange","canplay","loadeddata"])null===(i=null===(t=window.browser_mod)||void 0===t?void 0:t._audio_player)||void 0===i||i.addEventListener(e,()=>this.requestUpdate());null===(o=null===(s=window.browser_mod)||void 0===s?void 0:s._video_player)||void 0===o||o.addEventListener(event,()=>this.requestUpdate()),null===(n=window.browser_mod)||void 0===n||n.addEventListener("browser-mod-ready",()=>this._reconnect())}handleMute(e){window.browser_mod.player.muted=!window.browser_mod.player.muted}handleVolumeChange(e){const t=parseFloat(e.target.value);window.browser_mod.player.volume=t/100}handleMoreInfo(e){var t,i;this.dispatchEvent(new CustomEvent("hass-more-info",{bubbles:!0,composed:!0,cancelable:!1,detail:{entityId:null===(i=null===(t=window.browser_mod.browserEntities)||void 0===t?void 0:t.player)||void 0===i?void 0:i.entity_id}}))}handlePlayPause(e){!window.browser_mod.player.src||window.browser_mod.player.paused||window.browser_mod.player.ended?(window.browser_mod.player.play(),window.browser_mod._show_video_player()):window.browser_mod.player.pause()}handleVolumeDown(e){window.browser_mod.player.volume=Math.max(window.browser_mod.player.volume-.1,0)}handleVolumeUp(e){window.browser_mod.player.volume=Math.min(window.browser_mod.player.volume+.1,1)}handleReload(e){const t=window.browser_mod.player.src&&!window.browser_mod.player.paused&&!window.browser_mod.player.ended;window.browser_mod.player.load(),t&&window.browser_mod.player.play()}render(){var e,t,i;return window.browser_mod?(null===(e=window.browser_mod)||void 0===e?void 0:e.registered)?(null===(t=window.browser_mod)||void 0===t?void 0:t.browserEntities)?(null===(i=window.browser_mod)||void 0===i?void 0:i.playerEnabled)?Y`
      <ha-card>
        <div class="card-content">
          <ha-icon-button @click=${this.handleMute}>
            <ha-icon
              .icon=${window.browser_mod.player.muted?"mdi:volume-off":"mdi:volume-high"}
            ></ha-icon>
          </ha-icon-button>
          <ha-icon-button @click=${this.handleVolumeDown}>
            <ha-icon .icon=${"mdi:volume-minus"}></ha-icon>
          </ha-icon-button>
          <ha-icon-button @click=${this.handleVolumeUp}>
            <ha-icon .icon=${"mdi:volume-plus"}></ha-icon>
          </ha-icon-button>
          <ha-slider
            labeled
            min="0"
            max="100"
            step="1"
            ?disabled=${window.browser_mod.player.muted}
            value=${100*window.browser_mod.player.volume}
            @change=${this.handleVolumeChange}
          ></ha-slider>

          ${"stopped"===window.browser_mod.player_state?Y`<div class="placeholder"></div>`:Y`
                <ha-icon-button @click=${this.handlePlayPause} highlight>
                  <ha-icon
                    .icon=${!window.browser_mod.player.src||window.browser_mod.player.ended||window.browser_mod.player.paused?"mdi:play":"mdi:pause"}
                  ></ha-icon>
                </ha-icon-button>
              `}
          <ha-icon-button @click=${this.handleReload}>
            <ha-icon .icon=${"mdi:reload"}></ha-icon>
          </ha-icon-button>
          <ha-icon-button @click=${this.handleMoreInfo}>
            <ha-icon .icon=${"mdi:cog"}></ha-icon>
          </ha-icon-button>
        </div>

        <div class="browser-id">${window.browser_mod.browserID}</div>
      </ha-card>
    `:Y`
        <ha-card>
          <ha-alert> Media player disabled for this browser. </ha-alert>
        </ha-card>
      `:(window.setTimeout(()=>this.requestUpdate(),100),Y``):Y`
        <ha-card>
          <ha-alert> This browser is not registered to Browser Mod. </ha-alert>
        </ha-card>
      `:(window.setTimeout(()=>this.requestUpdate(),100),Y``)}static get styles(){return a`
      :host([hidden]) {
        display: none;
      }
      :host([edit-mode="true"]) {
        display: block !important;
      }
      paper-icon-button[highlight] {
        color: var(--accent-color);
      }
      .card-content {
        display: flex;
        justify-content: center;
        align-items: center;
      }
      .placeholder {
        width: 24px;
        padding: 8px;
      }
      .browser-id {
        opacity: 0.7;
        font-size: xx-small;
        margin-top: -10px;
        user-select: all;
        -webkit-user-select: all;
        -moz-user-select: all;
        -ms-user-select: all;
      }
      ha-icon-button ha-icon {
        display: flex;
      }
      ha-slider {
        flex-grow: 2;
        flex-shrink: 2;
        width: 100%;
      }
    `}}var be;t([he()],me.prototype,"hass",void 0),t([he({attribute:"edit-mode",reflect:!0})],me.prototype,"editMode",void 0),customElements.get("browser-player")||customElements.define("browser-player",me);const we=new WeakMap,fe=()=>{};be=Symbol.toStringTag;let ye=class e{constructor(e){this.subscribers=[],this.settlement=null,this[be]="Unpromise",this.promise="function"==typeof e?new Promise(e):e;const t=this.promise.then(e=>{const{subscribers:t}=this;this.subscribers=null,this.settlement={status:"fulfilled",value:e},null==t||t.forEach(({resolve:t})=>{t(e)})});"catch"in t&&t.catch(e=>{const{subscribers:t}=this;this.subscribers=null,this.settlement={status:"rejected",reason:e},null==t||t.forEach(({reject:t})=>{t(e)})})}subscribe(){let e,t;const{settlement:i}=this;if(null===i){if(null===this.subscribers)throw new Error("Unpromise settled but still has subscribers");const i=function(){let e,t;return{promise:new Promise((i,s)=>{e=i,t=s}),resolve:e,reject:t}}();this.subscribers=function(e,t){return[...e,t]}(this.subscribers,i),e=i.promise,t=()=>{null!==this.subscribers&&(this.subscribers=function(e,t){const i=e.indexOf(t);return-1!==i?function(e,t){return[...e.slice(0,t),...e.slice(t+1)]}(e,i):e}(this.subscribers,i))}}else{const{status:s}=i;e="fulfilled"===s?Promise.resolve(i.value):Promise.reject(i.reason),t=fe}return Object.assign(e,{unsubscribe:t})}then(e,t){const i=this.subscribe(),{unsubscribe:s}=i;return Object.assign(i.then(e,t),{unsubscribe:s})}catch(e){const t=this.subscribe(),{unsubscribe:i}=t;return Object.assign(t.catch(e),{unsubscribe:i})}finally(e){const t=this.subscribe(),{unsubscribe:i}=t;return Object.assign(t.finally(e),{unsubscribe:i})}static proxy(t){const i=e.getSubscribablePromise(t);return typeof i<"u"?i:e.createSubscribablePromise(t)}static createSubscribablePromise(t){const i=new e(t);return we.set(t,i),we.set(i,i),i}static getSubscribablePromise(e){return we.get(e)}static resolve(t){const i="object"==typeof t&&null!==t&&"then"in t&&"function"==typeof t.then?t:Promise.resolve(t);return e.proxy(i).subscribe()}static async any(t){const i=(Array.isArray(t)?t:[...t]).map(e.resolve);try{return await Promise.any(i)}finally{i.forEach(({unsubscribe:e})=>{e()})}}static async race(t){const i=(Array.isArray(t)?t:[...t]).map(e.resolve);try{return await Promise.race(i)}finally{i.forEach(({unsubscribe:e})=>{e()})}}static async raceReferences(e){const t=e.map(Ae);try{return await Promise.race(t)}finally{for(const e of t)e.unsubscribe()}}};function Ae(e){return ye.proxy(e).then(()=>[e])}const Ee="SELECTTREE-TIMEOUT";async function $e(e,t=!1){var i;if((null===(i=e.localName)||void 0===i?void 0:i.includes("-"))&&await customElements.whenDefined(e.localName),e.updateComplete&&await e.updateComplete,t&&(e.pageRendered&&await e.pageRendered,e._panelState)){let t=0;for(;"loaded"!==e._panelState&&t++<5;)await new Promise(e=>setTimeout(e,100))}}async function Se(e,t,i=!1){let s=[e];for("string"==typeof t&&(t=t.split(/(\$| )/));""===t[t.length-1];)t.pop();for(const[e,i]of t.entries()){const e=s[0];if(!e)return null;i.trim().length&&($e(e),s="$"===i?[e.shadowRoot]:e.querySelectorAll(i))}return i?s:s[0]}async function Ce(e,t,i=!1,s=1e4){return ye.race([Se(e,t,i),new Promise((e,t)=>setTimeout(()=>t(new Error(Ee)),s))]).catch(e=>{if(!e.message||e.message!==Ee)throw e;return null})}async function xe(e){let t=await i(e);for(;null===t;)await new Promise(e=>setTimeout(e,100)),t=await i(e);return t||null;async function i(e){let t=await Ce(e,"home-assistant$home-assistant-main$ha-panel-lovelace$hui-root");if(!t){let t=await Ce(e,"home-assistant$home-assistant-main$partial-panel-resolver>*");if("ha-panel-lovelace"!==(null==t?void 0:t.localName))return!1}return t||(t=await Ce(e,"hc-main $ hc-lovelace $ hui-view")),t||(t=await Ce(e,"hc-main $ hc-lovelace $ hui-panel-view")),t}}async function qe(){var e;void 0===(null!==(e=customElements.get("home-assistant"))&&void 0!==e?e:customElements.get("hc-main"))&&await ye.race([customElements.whenDefined("home-assistant"),customElements.whenDefined("hc-main")]);const t=customElements.get("home-assistant")?"home-assistant":"hc-main";for(;!document.querySelector(t);)await new Promise(e=>window.setTimeout(e,100));return document.querySelector(t)}async function Ie(){const e=await qe();for(;!e.hass;)await new Promise(e=>window.setTimeout(e,100));return e.hass}async function Me(e){(await qe()).provideHass(e)}const ke=async()=>{var e,t,i;if(void 0!==window.loadCardHelpers)return;await customElements.whenDefined("partial-panel-resolver");const s=document.createElement("partial-panel-resolver")._getRoutes([{component_name:"lovelace",url_path:"a"}]);await(null===(i=null===(t=null===(e=null==s?void 0:s.routes)||void 0===e?void 0:e.a)||void 0===t?void 0:t.load)||void 0===i?void 0:i.call(t));try{const e=document.createElement("ha-panel-lovelace");e.hass=await Ie(),e.panel={config:{mode:"yaml"}},await e._fetchConfig(!1)}catch(e){}},Te=async()=>{if(customElements.get("ha-form"))return;await ke();const e=await window.loadCardHelpers();if(!e)return;const t=await e.createCardElement({type:"button"});t&&await t.constructor.getConfigElement()};function Pe(e=!1){return function(t,i,s){const o=s.value;let n;const r=function(...t){if(e&&!1===n&&(n=!0),void 0!==n)return;n=!1;const i=o.bind(this)(...t);return n?(n=void 0,r.bind(this)(...t)):(n=void 0,i)};s.value=r}}const Oe=(e,t,i=!1)=>{let s;const o=(...o)=>{const n=i&&!s;clearTimeout(s),s=window.setTimeout(()=>{s=void 0,e(...o)},t),n&&e(...o)};return o.cancel=()=>{clearTimeout(s)},o};function je(e){return null==e||Array.isArray(e)?e:[e]}const Be=e=>e&&String(e[0]).toUpperCase()+String(e).slice(1)||"",Re=e=>e&&String(e).replace(/([a-z])([A-Z])/g,"$1 $2")||"";function De(e,t){if(e===t)return!0;if(typeof e!=typeof t)return!1;if(!(e instanceof Object&&t instanceof Object))return!1;for(const i in e)if(e.hasOwnProperty(i)){if(!t.hasOwnProperty(i))return!1;if(e[i]!==t[i]){if("object"!=typeof e[i])return!1;if(!De(e[i],t[i]))return!1}}for(const i in t)if(t.hasOwnProperty(i)&&!e.hasOwnProperty(i))return!1;return!0}const Le=e=>class extends e{constructor(){super(...arguments),this.ready=!1,this._connected=!1,this.connectionPromise=new Promise(e=>{this._connectionResolve=e}),this.browserEntities={},this.onReady=()=>{this.ready=!0,this.LOG("Integration ready: browser_mod loaded and update received"),this.fireBrowserEvent("browser-mod-ready"),window.setTimeout(()=>this.sendUpdate({}),1e3),this.userReady().then(()=>{this.onUserReady()}).catch(e=>{console.log(`Browser Mod: ${e}. User Frontend settings have not been applied`)})},this.onConnected=()=>{this._connected=!0,this.LOG("WebSocket connected")},this.onDisconnected=()=>{this.ready=!1,this._connected=!1,this.LOG("WebSocket disconnected"),this.fireBrowserEvent("browser-mod-disconnected")},this.onUserReady=()=>{this.LOG("Hass user data ready"),this.fireBrowserEvent("browser-mod-user-ready")}}LOG(...e){if(void 0===window.browser_mod_log)return;const t=new Date;if(console.log(`${t.toLocaleTimeString()}`,...e),this._connected)try{this.connection.sendMessage({type:"browser_mod/log",message:e[0]})}catch(e){console.log("Browser Mod: Error sending log:",e)}}fireBrowserEvent(e,t=void 0){this.dispatchEvent(new CustomEvent(e,{detail:t,bubbles:!0}))}async entitiesReady(){if(this.ready&&!this.registered)return!1;if(Object.keys(this.browserEntities).length>0)return!0;{let e=0;for(;0===Object.keys(this.browserEntities).length&&e++<20;)if(await new Promise(e=>setTimeout(e,500)),this.ready&&!this.registered)return!1;if(Object.keys(this.browserEntities).length>0)return!0;throw new Error("Browser entities not available after 10 seconds")}}async userReady(){if(this.user)return!0;{let e=0;for(;!this.user&&e++<20;)await new Promise(e=>setTimeout(e,500));if(this.user)return!0;throw new Error("User data not available after 10 seconds")}}incoming_message(e){var t;if(this._connected||this.onConnected(),e.command)this.LOG("Command:",e),this.fireBrowserEvent(`command-${e.command}`,e);else if(e.browserEntities){let t=this.browserEntities;this.browserEntities=e.browserEntities,De(t,this.browserEntities)||this.fireBrowserEvent("browser-mod-entities-update")}else e.result&&this.update_config(e.result);null===(t=this._connectionResolve)||void 0===t||t.call(this),this._connectionResolve=void 0}update_config(e){var t;this.LOG("Receive:",e);let i=!1;!this.registered&&(null===(t=e.browsers)||void 0===t?void 0:t[this.browserID])&&(i=!0),this._data=e,this.registered||!0!==this.global_settings.autoRegister||(this.registered=!0),this.ready||this.onReady(),this.fireBrowserEvent("browser-mod-config-update"),i&&this.sendUpdate({})}async connect(){const e=(await Ie()).connection;this.connection=e;const t=()=>{this.LOG("Subscribing to browser_mod/connect events"),e.subscribeMessage(e=>this.incoming_message(e),{type:"browser_mod/connect",browserID:this.browserID})};t(),e.subscribeEvents(e=>{var i;"browser_mod"===(null===(i=e.data)||void 0===i?void 0:i.component)&&(this.LOG("Detected browser_mod component load"),t())},"component_loaded"),e.addEventListener("ready",()=>{this.onConnected()}),e.addEventListener("disconnected",()=>{this.onDisconnected()}),window.addEventListener("connection-status",e=>{"connected"===e.detail&&this.onConnected(),"disconnected"===e.detail&&this.onDisconnected()}),Me(this)}get config(){var e,t;return null!==(t=null===(e=this._data)||void 0===e?void 0:e.config)&&void 0!==t?t:{}}get user(){var e;return null===(e=this.hass)||void 0===e?void 0:e.user}get browsers(){var e,t;return null!==(t=null===(e=this._data)||void 0===e?void 0:e.browsers)&&void 0!==t?t:[]}get registered(){var e;return void 0!==(null===(e=this.browsers)||void 0===e?void 0:e[this.browserID])}get browser_locked(){var e,t;return null===(t=null===(e=this.browsers)||void 0===e?void 0:e[this.browserID])||void 0===t?void 0:t.locked}set registered(e){(async()=>{if(e){if(this.registered||this.global_settings.lockRegister)return;await this.connection.sendMessage({type:"browser_mod/register",browserID:this.browserID})}else{if(!this.registered)return;await this.connection.sendMessage({type:"browser_mod/unregister",browserID:this.browserID})}})()}async _reregister(e={}){await this.connection.sendMessage({type:"browser_mod/register",browserID:this.browserID,data:Object.assign(Object.assign({},this.browsers[this.browserID]),e)})}get global_settings(){var e,t;const i={},s=null!==(t=null===(e=this._data)||void 0===e?void 0:e.settings)&&void 0!==t?t:{};for(const[e,t]of Object.entries(s))null!==t&&(i[e]=t);return i}get user_settings(){var e,t,i,s;const o={},n=null!==(s=null===(t=null===(e=this._data)||void 0===e?void 0:e.user_settings)||void 0===t?void 0:t[null===(i=this.user)||void 0===i?void 0:i.id])&&void 0!==s?s:{};for(const[e,t]of Object.entries(n))null!==t&&(o[e]=t);return o}get browser_settings(){var e,t,i;const s={},o=null!==(i=null===(t=null===(e=this.browsers)||void 0===e?void 0:e[this.browserID])||void 0===t?void 0:t.settings)&&void 0!==i?i:{};for(const[e,t]of Object.entries(o))null!==t&&(s[e]=t);return s}get settings(){return Object.assign(Object.assign(Object.assign({},this.global_settings),this.browser_settings),this.user_settings)}set_setting(e,t,i){var s;switch(i){case"global":this.connection.sendMessage({type:"browser_mod/settings",key:e,value:t});break;case"user":{const i=this.user.id;this.connection.sendMessage({type:"browser_mod/settings",user:i,key:e,value:t});break}case"browser":{const i=null===(s=this.browsers[this.browserID])||void 0===s?void 0:s.settings;i[e]=t,this._reregister({settings:i});break}}}get cameraEnabled(){return this.registered?this.browsers[this.browserID].camera:null}set cameraEnabled(e){this._reregister({camera:e})}get playerEnabled(){var e,t,i;return this.registered?null!==(i=null===(t=null===(e=this.browserEntities)||void 0===e?void 0:e.player)||void 0===t?void 0:t.enabled)&&void 0!==i&&i:null}get screenEnabled(){var e,t,i;return this.registered?null!==(i=null===(t=null===(e=this.browserEntities)||void 0===e?void 0:e.screen)||void 0===t?void 0:t.enabled)&&void 0!==i&&i:null}sendUpdate(e){if(this.ready&&this.registered){this.LOG("Send:",e);try{this.connection.sendMessage({type:"browser_mod/update",browserID:this.browserID,data:e})}catch(e){console.log("Browser Mod: Error sending update:",e)}}}browserIDChanged(e,t){var i,s;this.fireBrowserEvent("browser-mod-config-update"),void 0!==(null===(i=this.browsers)||void 0===i?void 0:i[e])&&void 0===(null===(s=this.browsers)||void 0===s?void 0:s[this.browserID])&&(async()=>{await this.connection.sendMessage({type:"browser_mod/register",browserID:e,data:Object.assign(Object.assign({},this.browsers[e]),{browserID:this.browserID})})})()}},Ue="browser_mod-screen_state",He=e=>class extends e{constructor(){super(),this._listeners={},this._brightness=255;const e=this._panel=document.createElement("div");document.body.append(e),e.classList.add("browser-mod-blackout"),e.attachShadow({mode:"open"});const t=document.createElement("style");e.shadowRoot.append(t),t.innerHTML="\n        :host {\n          background: rgba(0,0,0, var(--darkness));\n          position: fixed;\n          left: 0;\n          top: 0;\n          bottom: 0;\n          right: 0;\n          width: 100%;\n          height: 100%;\n          z-index: 10000;\n          display: block;\n          pointer-events: none;\n        }\n        :host([dark]) {\n          background: rgba(0,0,0,1);\n        }\n      ",this.addEventListener("browser-mod-user-ready",()=>{this.entitiesReady().then(()=>{this.screenEnabled&&(this.addEventListener("command-screen_off",()=>this._screen_off()),this.addEventListener("command-screen_on",e=>this._screen_on(e)),this.addEventListener("fully-update",()=>this.send_screen_status()),this.addEventListener("browser-mod-disconnected",()=>this._screen_save_state()),this._screen_restore_state())}).catch(e=>{console.warn(`Browser Mod: ${e}. Timeout waiting for browser entities to be ready. Screen light sensor will not be available`)})},{once:!0})}send_screen_status(){this._screen_state=!this._panel.hasAttribute("dark");let e=this._brightness;this.fully&&(this._screen_state=this.fully_screen,e=this.fully_brightness),this.sendUpdate({screen_on:this._screen_state,screen_brightness:e}),this._screen_save_state()}_screen_save_state(){if(this.settings.saveScreenState){let e={screen_on:this._screen_state,screen_brightness:this._brightness};localStorage.setItem(Ue,JSON.stringify(e))}}_screen_restore_state(){if(this.settings.saveScreenState){const e=localStorage.getItem(Ue);if(e){const{screen_on:t,screen_brightness:i}=JSON.parse(e);this._screen_state=t,this._brightness=i,this._screen_state?this._screen_on({detail:{brightness:this._brightness}}):this._screen_off()}else this._screen_on()}else this._screen_on()}_screen_off(){this.fully?this.fully_screen=!1:this._panel.setAttribute("dark",""),this.send_screen_status();const e=()=>this._screen_on();for(const t of["pointerdown","pointermove","keydown"])this._listeners[t]=e,window.addEventListener(t,e)}_screen_on(e=void 0){var t,i;this.fully?(this.fully_screen=!0,(null===(t=null==e?void 0:e.detail)||void 0===t?void 0:t.brightness)&&(this.fully_brightness=e.detail.brightness)):((null===(i=null==e?void 0:e.detail)||void 0===i?void 0:i.brightness)&&(this._brightness=e.detail.brightness,this._panel.style.setProperty("--darkness",1-e.detail.brightness/255)),this._panel.removeAttribute("dark")),this.send_screen_status();for(const e of["pointerdown","pointermove","keydown"])this._listeners[e]&&(window.removeEventListener(e,this._listeners[e]),this._listeners[e]=void 0)}},Ne=e=>{class i extends e{constructor(){super(),this._canPlayVideo=!1,this._canPlayAudio=!1,this.addEventListener("browser-mod-entities-update",()=>{this._setup_media_player()},{once:!0})}_setup_media_player(){if(this.playerEnabled){this._audio_player=new Audio,this._audio_player.muted=!0,this._video_player=document.createElement("video"),this._video_player.setAttribute("playsinline",""),this._video_player.controls=!0,this._video_player.style.setProperty("width","100%"),this._video_player.muted=!0,this.player=this._audio_player,this._player_enabled=!1,this.extra={};for(const e of["play","pause","ended","volumechange"])this._audio_player.addEventListener(e,()=>this._player_update()),this._video_player.addEventListener(e,()=>this._player_update());for(const e of["timeupdate"])this._audio_player.addEventListener(e,()=>this._player_update_throttled()),this._video_player.addEventListener(e,()=>this._player_update_throttled());this.videoInteraction.then(()=>{this._player_enabled=!0,this._canPlayVideo=!0,this._player_update()}),this.audioInteraction.then(()=>{this._canPlayAudio=!0,this._video_player.muted=!1,this._audio_player.muted=!1,this._player_update()}),this.addEventListener("command-player-play",e=>{var t,i,s,o,n,r;if(this.player.src&&void 0===(null===(t=e.detail)||void 0===t?void 0:t.media_content_id))return this.player.play(),void this._show_video_player();(this.player.src||void 0!==(null===(i=e.detail)||void 0===i?void 0:i.media_content_id))&&(this.player.src&&this.player.pause(),(null===(s=e.detail)||void 0===s?void 0:s.media_type)&&((null===(o=e.detail)||void 0===o?void 0:o.media_type.startsWith("video"))?this.player=this._video_player:this.player=this._audio_player),(null===(n=e.detail)||void 0===n?void 0:n.media_content_id)&&(this.player.src=e.detail.media_content_id),this.extra=null===(r=e.detail)||void 0===r?void 0:r.extra,this.player.play(),this._show_video_player())}),this.addEventListener("command-player-pause",e=>this.player.pause()),this.addEventListener("command-player-stop",e=>{this.player.src=null,this.player.pause()}),this.addEventListener("command-player-set-volume",e=>{var t;void 0!==(null===(t=e.detail)||void 0===t?void 0:t.volume_level)&&(this.player.volume=e.detail.volume_level)}),this.addEventListener("command-player-mute",e=>{var t;void 0!==(null===(t=e.detail)||void 0===t?void 0:t.mute)?this.player.muted=Boolean(e.detail.mute):this.player.muted=!this.player.muted}),this.addEventListener("command-player-seek",e=>{this.player.currentTime=e.detail.position,setTimeout(()=>this._player_update(),10)}),this.addEventListener("command-player-turn-off",e=>{this.player===this._video_player&&this._video_player.isConnected?this.closePopup({tag:"media_player"}):this.player.src&&this.player.pause(),this.player.src="",this._player_update()}),this._player_update()}}_show_video_player(){var e;this.player===this._video_player&&this.player.src&&!this._video_player.isConnected?(Ce(document,"home-assistant $ dialog-media-player-browse").then(e=>null==e?void 0:e.closeDialog()),this.showPopup(Object.assign({title:void 0,content:this._video_player,dismiss_action:()=>this._video_player.pause(),initial_style:"wide",tag:"media_player"},null===(e=this.extra)||void 0===e?void 0:e.popup))):this.player!==this._video_player&&this._video_player.isConnected&&this.closePopup({tag:"media_player"})}_player_update_throttled(){this._player_update()}_player_update(){const e=this._player_enabled?this.player.src&&this.player.src!==window.location.href?this.player.ended?"stopped":this.player.paused?"paused":"playing":"off":"unavailable";this.sendUpdate({player:{volume:this.player.volume,muted:this.player.muted,src:this.player.src,state:e,media_duration:this.player.duration,media_position:this.player.currentTime,extra:Object.assign(Object.assign({},this.extra),{videoInteractionRequired:!this._canPlayVideo,audioInteractionRequired:!this._canPlayAudio})}})}}var s;return t([(s=3e3,function(e,t,i){const o=i.value;let n;i.value=function(...e){if(!n)return n=setTimeout(()=>n=void 0,s),o.bind(this)(...e)}})],i.prototype,"_player_update_throttled",null),i},Ye=e=>class extends e{constructor(){super(),this._framerate=2,this.cameraError=!1,this.addEventListener("browser-mod-user-ready",()=>{this._setup_camera()},{once:!0})}async _setup_camera(){var e;if(this._cameraVideo)return;if(await this.connectionPromise,await this.videoInteraction,!this.cameraEnabled)return;if(this.fully)return this.update_camera();const t=document.createElement("div");document.body.append(t),t.classList.add("browser-mod-camera"),t.attachShadow({mode:"open"});const i=document.createElement("style");t.shadowRoot.append(i),i.innerHTML="\n      :host {\n        display: none;\n      }";const s=this._cameraVideo=document.createElement("video");t.shadowRoot.append(s),s.autoplay=!0,s.playsInline=!0,s.style.display="none";const o=this._canvas=document.createElement("canvas");if(t.shadowRoot.append(o),o.style.display="none",!navigator.mediaDevices)return this.cameraError=!0,void this.fireBrowserEvent("browser-mod-config-update");try{let t=!0;if(null===(e=this.settings)||void 0===e?void 0:e.cameraResolution){const e=this.settings.cameraResolution.match(/(\d+)\s*x\s*(\d+)/i);if(e){const i=parseInt(e[1],10);t={width:{ideal:i},height:{ideal:parseInt(e[2],10)}}}}const i=await navigator.mediaDevices.getUserMedia({video:t,audio:!1});s.srcObject=i,s.play(),this.update_camera()}catch(e){if("NotAllowedError"!==e.name)throw e;this.cameraError=!0,this.fireBrowserEvent("browser-mod-config-update")}}async update_camera(){var e,t;if(!this.cameraEnabled){const t=null===(e=this._cameraVideo)||void 0===e?void 0:e.srcObject;return void(t&&(t.getTracks().forEach(e=>e.stop()),this._cameraVideo.srcObject=void 0))}if(this.fully)this.sendUpdate({camera:this.fully_camera});else if(null===(t=this._cameraVideo)||void 0===t?void 0:t.videoWidth){const e=this._cameraVideo,t=e.videoWidth,i=e.videoHeight;this._canvas.width=t,this._canvas.height=i;this._canvas.getContext("2d").drawImage(e,0,0,t,i),this.sendUpdate({camera:this._canvas.toDataURL("image/jpeg")})}const i=Math.round(1e3/this._framerate);setTimeout(()=>this.update_camera(),i)}},Ge=e=>class extends e{constructor(){super(),this.videoInteraction=new Promise(e=>{this._videoInteractionResolve=e}),this.audioInteraction=new Promise(e=>{this._audioInteractionResolve=e}),this.addEventListener("browser-mod-user-ready",()=>{this.entitiesReady().then(()=>{!this.playerEnabled&&!this.cameraEnabled||this._versionNotificationPending||(this._audioRequired=this.playerEnabled,this.setupInteraction())}).catch(e=>{console.warn(`Browser Mod: Failed to wait for browser entities to be ready. Player will be unavailable. Error: ${e}`)})},{once:!0})}_clearInteract(){this._video.remove(),this._video=void 0,this._interactElement.remove(),this._interactElement=void 0}_checkInteraction(e=void 0){if(!this._interactElement)return;const t=this._video.play();void 0!==t&&t.then(()=>{if(this._videoInteractionResolve(),this._video.pause(),this._audioRequired){this._video.muted=!1,this._video.currentTime=0;const t=this._video.play();void 0!==t&&t.then(()=>{this._audioInteractionResolve(),this._video.pause()}).catch(t=>{e&&!this.settings.hideInteractIcon?e():this._clearInteract()})}}).catch(t=>{e&&!this.settings.hideInteractIcon?e():this._clearInteract()})}minimalInteraction(){if(!this._interactElement)return;const e=document.createElement("span");e.textContent="Browser Mod",this._interactElement.shadowRoot.append(e);const t=document.createElement("ha-icon");t.setAttribute("id","tap"),t.icon="mdi:gesture-tap",this._interactElement.shadowRoot.append(t),this._interactElement.setAttribute("minimal","");const i=this.settings.fullInteraction?()=>this.fullInteraction():void 0;this._interactElement.addEventListener("pointerdown",()=>{this._checkInteraction(i)},{once:!0}),this._interactElement.addEventListener("touchstart",()=>{this._checkInteraction(i)},{once:!0})}fullInteraction(){if(!this._interactElement)return;const e=document.createElement("ha-icon-button");e.setAttribute("id","close");const t=document.createElement("ha-icon");t.setAttribute("icon","mdi:close"),e.append(t),e.addEventListener("pointerdown",()=>{this._clearInteract()}),e.addEventListener("touchstart",()=>{this._clearInteract()}),this._interactElement.shadowRoot.append(e);const i=document.createElement("source");i.setAttribute("type","audio/mp3"),i.setAttribute("src","data:audio/mp3;base64,//PkZAAghSh2AGt5kB6KMR2UyNNIZ0w1cy0UjhQODThmk5GSO2XN4qMilGCwWFgEAHCRoeBgCMjBUNwYCFRYjHGEHmXHB2A3BgzackLAAKCgQQBCAwYRCFZlRJhBwhHjBQsEoNODHE81tKBZwdYgG5rZkB4OrkoDC4EVEDjDEGGRUHkSUg0+F7qwL/WMlyLBl2Ee0ZCQEuETGBhiD8ARhmaBQiHMUYa4OIgz1xg4QChUAEDmKcbR5TWf4J3KGiiDBkEaMiHdLZRAtoMgpfK5XclqFRjMHJxwembghkglpC3YgCHSQqUHOh2hnggABAWiAMijpxiGk3wHLNIJBdeik0kC8YWAQ9Lekww0AgPQAInqqKdvMzuJSC2tiq4N4A5Tuu87rXmcopBAI0+cIpnGCMOGp2flERh55nygeKReWT9FF37jG89Y5Y27dSvcksFNJYkrQkgpu7Fn6JTIy/yMrKxI/8rDEiNJWSqIlFx8SI1Lq5YwvKMorEouPkiNAuomsZME6BdRc4Qi4nJG82E1E2XubxVpzglqzNVDl2BvEFzQMuaUACwZmxpOhdgqKTDq8aAnWtE3bTjNMccvkajwlAOhTPpQcrjhewtoYY8bSEcJURKjABgUEQACosHH4ghg//PkREwdqRqyAKzoALvqNVwBWdABOhwYPM6Ja+uuIINgoeIgwGKMqVVMOLAQ8AhQMPhT4GADGVLmhTmlLgoe4yKi+TCjTIizGAk8TClTMlzKkUSl+Q0/LOQCFAwda7K15A4B6xDAEiggYEGpsXgAgYWEFs19GLImREmBAhANLRUphxpECMIESjbm48v3fkrRl6qwgIGyeN5e+i5AICMeLCB7cKURAAMIeVR4MALkYyYMOiPDc/ES6MQRuJfQhJJilLBAAGCLAAgIMEYG7ada7DL1AdZslmlYTOgyQ6ADFJGQDYiDqCEKZ9KDk8cL2FtDDHjaQjhKiJUYAMCgiAAVFg4/EEMB0ODB5nRLX11xBBsFDxEGAxRlSqphxYCHgEKBh8KfAwAYypc0Kc0pcFD3GRUXyYUaZEWYwEniYUqZkuZUiiUvyGn5ZyAQoGDrXZWvIHAPWIYAkUEDAg1Ni8AEDCwgtmvoxZEyIkwIEIBpaKlMONIgRhAiUbc3Hl+78laMvVWEBA2TxvL30XIBARjxYQPbhSiIABhDyqPBgBcjGTBh0R4bn4ixYcNHQzqLDFShsWw4EQedbeJkBAYWGsS0BLww2F6+N1v0hC1hgTBImGuDMYogflLyVbMFsCcQANAY//PkRDocbTjoAM54ADO6ccgBm+gACxWA1pkSjFsA8MFYBMwEQF7uqTlqpWkE56IwsAAYBoA4AAYDAINV8728a/Lfb0+YDgDwQAaGADiQAgBARDAF9Zd596mvVJ/uGL+AoCt8adCYYBgAiwZgnAMfX1hf7+so686P8j4l3Dl+BDAxCTMJMCUw5QezARAMR4MCYAEwhwlw4H9in6/PDff///nyPGgl2Gff/5LIkglIA4AMZAeFgRAEAuEAAMbUv7jNvs9ZmKccMVV6jB0DwEHE71qhoOGlAhnpPFX/uy340YVkeYimYa6IpS8lWzEMFxgCA4BHUPirMM5gcFh9MEQHu6pOWtU25zqjRbwHBeYAAcHAZlXzvbxlf2/vXzBIEERVLxCAJgSBIcAesu8+9TTlSf7hi/gQDbdZehMMDAEWDMTgY+vrC/39ZR150f5HxLuHL8CGGJJmSYSmco9mCIGI8GEwAmQ5Lhw/sU/X54b7///8+R40Euwz7//JZEkEpAHAGMg8LCIAgXCAAY2pf2qhUCgMCxSSwQBgYBgAkLjGBDmZgQSC/oFI43+UwwxHQxSAUzICYz9Yk0HbMwBIcxtA8wxA0xMDg648oy3nMA4FgGAwAgGE0OIGJoJANQMgYBwa//PkZFIkSZkxLs7YATKiZmpfnOgCgeWlZAYPBZgYdQ0gZHABAYMgSiBRnQMTADAcEYRqUQMVgPgBgSjTQE9EXIcWyKpl0njFMgpfMlyNFAjkDkjgFlKfo/pLUIoHQgYCQAhcXrFqDlBP/WYAiAuF0CCBdQFownwVuH0ABAKBIB5OChwbHwRALDGgYIDbA9ETJhnwMAgHgMBgCAJBSAYCyBgYBCCYDBpJmJXHPDEZCheAEgEEXAKAeXssmQBQAxZQ4BHg4wy4RbpgkAIEgCD4C5sDAKEMDAqBwLhRPr////////MyZeJsCkQCSy2gUmEQgBgBhxgYbL7MJIJepgk+GQhIiEGEEysAjOavM2sMwGOzJolMRhMxoJjpnQMkyUeA2QGBITmHwKJ/gkATxxZDEgPzDkLwUCqqtjExCEYaC55bpi0JhiEDq/7dbDncZ/kaq07+xemzx3S4bsU3///////+X/QRFl8Hf//clk///+m/iGEOP9OU8ga26+E2/bzwxFJZKaP9ug/jnNBZzHu/vucbvwY8mbj5f+/d+msSy3KMv//mI5qnWW1qls////iWAAw/AAoDswwXiC4ARbswNgTzAiAfMAwJkwygpzA/AfMJwIkwRgUTACB+MMUO4xbS//PkRDAcxSckP+90ADgaUjgZ3ugBMDLJL8M4cWo2+zuDO+YHN/Zuc3zJ8Tk6a5MhGRY3gS4Da4X1NBNXo00CGT3CNjKo2TO0mzFsFQ4FmxR99LH8/8rmt54Xe//////9w/uHM7ff+vlhzvO/3D94///MxFDiYQA2LAw3KB3dluqZc6KpdlJiZRgcx2YTKKeAakoZEXyX9XjuMNWf7+pU7TPkJSxWssh5haqtxdVJ0wAA0wSBkwYBswWAVdrmuEu6lpHeBr//lwfX40qLgKthiTlQEYCwE5gHAGmAEC+YNQKpgIgTmDUC2YHwAZgHAkGEGEsYbYrRjnj0GRuGAaQZIRk7IEmq4j2anjXZsdL6mHFIcbppZRtjL5mgOsoaahBZ8BGhl0a5nST5i2C4cCSnS2WGUmHP////////////7r/1+8+/+fcOd//7h+8f//mX1GAJMMAtEgwYU87XYrqVJzlpQMBI8BEdKAMYo1l7YYjbw1IYT2BQFJxSuCcXas67+ok1pRYs8kSsKpTepJdKV4s1IAFMCAbMIApMKArMJgRUFY6uZQaUyhr1MNoACVgAlbcMsYMSKMKHHFZm6h57ypDFhzFChl+PtTC1zBSAJMWg101ME/zIZCkMgEngxsR1//PkRDQcFYcaPWvPRjZ7DiRS68fIDD8MEMHYXEwdRYjBzCZMpgV8x1TujFAHoMzktwyJR6jFXDASRTxEfFuQmEakSGZamLhDQs/1eXRxyxnOh7PNdFqOeHAlprT+/99wN0rulK3/v++ei6hkADSvcocDKhDbC9MRXIMmROlssKVRQuR+J4+yVFiKNofYznXtm8UR5Kk5MRyxuFnBdjWXMU4VK5MZ05pv53//bX+v/nGv/m+/6Zvv4pfGd4vfGv77eTAFYBMqbOKIZIPiICUGjCMNGhAgHxYFCAGRYRQuIoKJUzOjM+A0k17Go1Dco1jLI5GNo5Gn0xNeozVH07odU0/8Q1Wdw83t44he41VMAoAFKBMdlTTazZrGcvmoxnL5XTxDn509PnzdeH783MUOHMKe3/59qWsMb+FTHP/z/CmjKZKFgGAaG5dXpNw6juAskMQ4rxFhckeLCgTeCRF0OYtRXhjCRpp9JnNMRq3cQgRii4i8WrbfZwOYhyJiklN1mT5ccwJ/m+t/2p7Tf7zib/X/SufEeU45z8zQagCyABKfKYjF1/S4yqxgoVmCwMYvIhgUMmAg8TCpLVPcxcczTSFMskAwmJTD0UPM1Y8ztjk48MLBoqAMyeAjHIgKowBT//PkZEQgZYsWLXMsijF7FiRcxtKcCMYBMwgLy2iXK60DC9g4C4Saoc+YASqaMyKosInWtAZ3N1QDuB1ZsJGHOaRIcsDqEJbIGAt2aiXjXmwBYFjyxH/bpAMil7+O3NPrI3cdupQSCL2JLBU7BqpYaiMqjM/EtHrgKDvVdI9JwuCo8AMSFap88YhbYPY3F6RnF5QSpoYzy6KXa1qjUNKEJbLp+cL0LljaxmNQvYutjULzpDRmh2dkIkoywVzh0yVmCGcLT84PzgtHh+VB5ePTr/f//8mAcoACDDf0uchLJKpAD4NMfeGOpm0HXR5L8GDI5szaY2cGbsIV/CfvMetDawwMAFLk5zIwZOweEi9KMrdGotuvRWxZMSaaNBZdxo6wSxVIMvaQh3TCTMXuqRPdYrbLUQfZAyFuzVkA602ALAtSWIjGCrTaAjWVeSEcKc3iaWJgisrJnVq+KN+utaTUCaG7sKu6juTq/N1yvYTz5/9yWVH5OE68LhHcnC47kyx15gjIxoUvMEZAyTG0BcgZJ0BtATME5QQtEqIkdd2Qw0wJmypX0ZctFoMGs8AwKLs6BA8uQFh5uEJrfB7RRqEYAAhCE0KQKIxAnMQMDDZMFQlmQCqPS8EglVERoqw5PVUL//PkZEYejfcEAWmH2DWrGfAAzxK8jXi/zCmhQQ86XryW4CZdKosyqB10ymdUygebgxr0Ey2GYcWNbiLZHWpeRGIO9aqdK1KURWjoJjwXHQ7Iya40B4VAaWwk1Q1dMpSpAJNhKRUyMpoEZi6hqaezQleqOYiUZGKJ6YVpiiEJwyKx9d3vTKNq0lWwnJ61ZpGaqj0rJyq4uZgbEmA9OTA2ktJ0Takqmpi4JSHVOGUYcAcGuIxfyoOQGtwsM/+EIDf//CEHsqrwY97iJ9KUhUw1SBUY1RgoqNIA5YuKacRKeXSMhlww0gzMgJMlNU4YzzIwPMUC8wONBUpmQRECgdIjBIuMhiZStuloCgZPQv1GUqlK0kX+0mMsEx6MSJ/YCm3wWNUh5rUPstxsu1H5uUOVXpYZfRMaN15JL4rLoBk0utYIjTNkqJYBjxpYTIxTkg0WE0bQsS6WJpCqYhMraqwiVZuDUSpmUnhUzKUYS9xVYCzkSJpXNikxeIlWbihRTp7j4pONqpExCgehpkQkhrtFTy5KqZFKAEl4p0uWka1mIXIlUKFQmVXg1FCzFC4Uh4ClUibSEKhYmInkJkiJldk1GSJFNDNmtVZihQopkJKkitCzaGEtqXpC5ETImpS9oRSz//PkZEYWzfr0tiTI5i87HbQAyxMU9VFKEifZCCJmkiO5RaLEiRJtNROTRo24SOJOi1ftRuU1MDEiRLW3mgGCWsSokUSJEgpJyMNWzTo/08/0WEioAQVpoBIzklAIKBgEsiMphYeSKiocgtdflRhxNqqWtSsMzMLCw8OTv//2ZmDoGw8VOTqVO9DSXyYT/gwUyA3OiigUPzkTYjHn2S9JQjVgOmo5Vgg5MkBClsQSAjk4Sulou4BICRXXuYBYB12oRJutdXP960xXQiSTaPMrVvs4us0u9oxUnRkZPWtOrTF3LMmK06jqVRFPceQvxq2ViJEirSElWbJcu6lJq8rf/sc/9ImkSL1uKilRFqyKREoKkSIVNWhykT41Nmtkmz8kmSlmAsKnqiklVyKQWFQqBImTBFosIkq//t6vCT8GhK6Cp2pMQU1FMy4xMDCqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq"),this._video.replaceChild(i,this._video.firstChild),this._video.load(),this._video.addEventListener("loadeddata",()=>{this._video.setAttribute("controls",""),this._interactElement.removeAttribute("minimal"),this._interactElement.setAttribute("full","")}),this._video.addEventListener("play",()=>{this._video.addEventListener("ended",()=>{window.setTimeout(()=>{this._videoInteractionResolve(),this._audioInteractionResolve()},250)})}),this._video.addEventListener("error",e=>{this._clearInteract();const t="Browser Mod: error checking ability to play audio.";this.callService("browser_mod.notification",{message:t}),console.log(t,e.toString())})}async setupInteraction(){if(await this.connectionPromise,!this.registered)return;this._interactElement=document.createElement("div"),document.body.append(this._interactElement),this._interactElement.classList.add("browser-mod-require-interaction"),this._interactElement.attachShadow({mode:"open"});const e=document.createElement("style");this._interactElement.shadowRoot.append(e),e.innerHTML='\n      :host {\n        position: fixed;\n        top: 0px;\n        left: 0px;\n        right: 0px;\n        bottom: 0px;\n        color: var(--warning-color, red);\n        opacity: 0.5;\n        z-index: 99999;\n        --icon-inset: 8px;\n        --mdc-icon-size: 48px;\n      }\n      :host([minimal]) {\n        display: grid;\n        grid-template-areas: "close" "video" "icon" "text";\n        grid-template-rows: min-content 1fr min-content min-content;\n      }\n      :host([full]) {\n        display: grid;\n        grid-template-areas: "close" "video" "icon" "text";\n        grid-template-rows: min-content 1fr min-content 1fr;\n        --mdc-icon-size: 250px;\n        opacity: 1.0;\n        background: rgba(0,0,0,0.5);\n      }\n      #tap {\n        grid-area: icon;\n        justify-self: self-end;\n        padding-right: calc(var(--icon-inset) + var(--safe-area-inset-bottom));\n      }\n      :host([full]) #tap {\n        justify-self: center;\n        align-self: self-start;\n      }\n      #close {\n        grid-area: close;\n        display: none;\n      }\n      :host([full]) #close {\n        display: inherit;\n        justify-self: self-start;\n        align-self: self-start;\n        --mdc-icon-size: 48px;\n        color: var(--white-color, white);\n        padding-top: calc(var(--icon-inset) + var(--safe-area-inset-bottom));\n        padding-left: calc(var(--icon-inset) + var(--safe-area-inset-bottom));\n        --mdc-ripple-hover-opacity: 0.2;\n        --mdc-ripple-press-opacity: 0.33;\n      }\n      span {\n        grid-area: text;\n        align-self: end;\n        justify-self: self-end;\n        padding-bottom: calc(var(--icon-inset) + var(--safe-area-inset-bottom));\n        padding-right: calc(var(--icon-inset) + var(--safe-area-inset-bottom));\n        font-size: 0.75rem;\n      }\n      :host([full]) span {\n        align-self: self-start;\n        justify-self: center;\n        font-size: 1.75em;\n      }\n      video {\n        grid-area: video;\n        display: none;\n      }\n      :host([full]) video {\n        display: inherit;\n        justify-self: center;\n        align-self: self-end;\n        width: 250px;\n        scale: 1.2;\n      }\n      @media all and (max-width: 450px), all and (max-height: 500px) {\n        :host {\n          --icon-inset: 20px;\n          --mdc-icon-size: 30px;\n        }\n        #tap {\n          padding-bottom: calc(var(--icon-inset) + var(--safe-area-inset-bottom));\n        }\n        span {\n          display: none;\n        }\n      }\n      ',this._video=document.createElement("video"),this._video.setAttribute("playsinline","");const t=document.createElement("source");t.setAttribute("type","video/mp4"),t.setAttribute("src","data:video/mp4;base64,AAAAGGZ0eXBpc29tAAAAAGlzb21tcDQxAAAACGZyZWUAAAAmbWRhdCELUCh9wBQ+4cAhC1AAfcAAPuHAIQtQAH3AAD7hwAAAAlNtb292AAAAbG12aGQAAAAAxzFHd8cxR3cAAV+QAAAYfQABAAABAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAG2lvZHMAAAAAEA0AT////xX/DgQAAAACAAABxHRyYWsAAABcdGtoZAAAAAfHMUd3xzFHdwAAAAIAAAAAAAAYfQAAAAAAAAAAAAAAAAEAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAWBtZGlhAAAAIG1kaGQAAAAAxzFHd8cxR3cAAKxEAAAL/xXHAAAAAAA0aGRscgAAAAAAAAAAc291bgAAAAAAAAAAAAAAAFNvdW5kIE1lZGlhIEhhbmRsZXIAAAABBG1pbmYAAAAQc21oZAAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAAAyHN0YmwAAABkc3RzZAAAAAAAAAABAAAAVG1wNGEAAAAAAAAAAQAAAAAAAAAAAAIAEAAAAACsRAAAAAAAMGVzZHMAAAAAA4CAgB8AQBAEgICAFEAVAAYAAAANdQAADXUFgICAAhIQBgECAAAAGHN0dHMAAAAAAAAAAQAAAAMAAAQAAAAAHHN0c2MAAAAAAAAAAQAAAAEAAAADAAAAAQAAABRzdHN6AAAAAAAAAAoAAAADAAAAFHN0Y28AAAAAAAAAAQAAACg="),this._video.append(t),this._video.muted=!0,this._interactElement.shadowRoot.append(this._video),this._checkInteraction(()=>this.minimalInteraction()),this.fully&&(this._videoInteractionResolve(),this._audioInteractionResolve());const i=this._audioRequired?[this.videoInteraction,this.audioInteraction]:[this.videoInteraction];Promise.all(i).then(()=>{this._clearInteract()})}},Ve=e=>class extends e{get fully(){return void 0!==window.fully}constructor(){if(super(),this._fully_screensaver=!1,this.fully){for(const e of["screenOn","screenOff","pluggedAC","pluggedUSB","onBatteryLevelChanged","unplugged","networkReconnect","onMotion","onDaydreamStart","onDaydreamStop"])window.fully.bind(e,`window.browser_mod.fullyEvent("${e}");`);window.fully.bind("onScreensaverStart","window.browser_mod._fully_screensaver = true; window.browser_mod.fullyEvent();"),window.fully.bind("onScreensaverStop","window.browser_mod._fully_screensaver = false; window.browser_mod.fullyEvent();")}}get fully_screen(){var e;return!1===this._fully_screensaver&&(null===(e=window.fully)||void 0===e?void 0:e.getScreenOn())}set fully_screen(e){var t,i,s;e?(null===(t=window.fully)||void 0===t||t.turnScreenOn(),null===(i=window.fully)||void 0===i||i.stopScreensaver()):null===(s=window.fully)||void 0===s||s.turnScreenOff()}get fully_brightness(){var e;return null===(e=window.fully)||void 0===e?void 0:e.getScreenBrightness()}set fully_brightness(e){var t;null===(t=window.fully)||void 0===t||t.setScreenBrightness(e)}get fully_camera(){var e;return null===(e=window.fully)||void 0===e?void 0:e.getCamshotJpgBase64()}get fully_data(){const e=window.fully;if(void 0===e)return"undefined";try{return{ip4Address:e.getIp4Address(),ip6Address:e.getIp6Address(),hostname:e.getHostname(),hostname6:e.getHostname6(),macAddress:e.getMacAddress(),wifiSsid:e.getWifiSsid(),wifiBssid:e.getWifiBssid(),wifiSignalLevel:e.getWifiSignalLevel(),serialNumber:e.getSerialNumber(),androidId:e.getAndroidId(),deviceId:e.getDeviceId(),deviceName:e.getDeviceName(),imei:e.getImei(),simSerialNumber:e.getSimSerialNumber(),batteryLevel:e.getBatteryLevel(),screenBrightness:e.getScreenBrightness(),screenOrientation:e.getScreenOrientation(),displayWidth:e.getDisplayWidth(),displayHeight:e.getDisplayHeight(),screenOn:e.getScreenOn(),plugged:e.isPlugged(),keyboardVisible:e.isKeyboardVisible(),wifiEnabled:e.isWifiEnabled(),wifiConnected:e.isWifiConnected(),networkConnected:e.isNetworkConnected(),bluetoothEnabled:e.isBluetoothEnabled(),screenRotationLocked:e.isScreenRotationLocked(),fullyVersion:e.getFullyVersion(),fullyVersionCode:e.getFullyVersionCode(),webViewVersion:e.getWebviewVersion(),androidVersion:e.getAndroidVersion(),androidSdk:e.getAndroidSdk(),deviceModel:e.getDeviceModel(),internalStorageTotalSpace:e.getInternalStorageTotalSpace(),internalStorageFreeSpace:e.getInternalStorageFreeSpace(),externalStorageTotalSpace:e.getExternalStorageTotalSpace(),externalStorageFreeSpace:e.getExternalStorageFreeSpace(),sensorInfo:e.getSensorInfo(),allRxBytesMobile:e.getAllRxBytesMobile(),allTxBytesMobile:e.getAllTxBytesMobile(),allRxBytesWifi:e.getAllRxBytesWifi(),allTxBytesWifi:e.getAllTxBytesWifi()}}catch(e){return String(e)}}fullyEvent(e=void 0){this.fireBrowserEvent("fully-update",{event:e})}},Qe=e=>class extends e{constructor(){super(),document.addEventListener("visibilitychange",()=>this._browser_state_update()),window.addEventListener("location-changed",()=>this._browser_state_update()),window.addEventListener("popstate",()=>setTimeout(()=>{this._browser_state_update()},0)),this.addEventListener("fully-update",()=>this._browser_state_update()),this.addEventListener("browser-mod-ready",()=>this._browser_state_update()),this.addEventListener("browser-mod-user-ready",()=>this._browser_state_update()),this.connectionPromise.then(()=>this._browser_state_update()),window.addEventListener("resize",Oe(function(){this._browser_state_update()}.bind(this),500))}_browser_state_update(){(async()=>{var e,t,i,s,o,n,r,a;const l=navigator.getBattery?await navigator.getBattery():void 0;this.sendUpdate({browser:{path:window.location.pathname,visibility:document.visibilityState,userAgent:navigator.userAgent,currentUser:null===(e=this.user)||void 0===e?void 0:e.name,fullyKiosk:this.fully||!1,width:window.innerWidth,height:window.innerHeight,battery_level:null!==(i=null===(t=window.fully)||void 0===t?void 0:t.getBatteryLevel())&&void 0!==i?i:100*(null==l?void 0:l.level),charging:null!==(o=null===(s=window.fully)||void 0===s?void 0:s.isPlugged())&&void 0!==o?o:null==l?void 0:l.charging,darkMode:null===(r=null===(n=this.hass)||void 0===n?void 0:n.themes)||void 0===r?void 0:r.darkMode,userData:this.user,ip_address:null===(a=window.fully)||void 0===a?void 0:a.getIp4Address(),fully_data:this.fully_data}})})()}async browser_navigate(e){e&&(history.pushState(null,"",e),window.dispatchEvent(new CustomEvent("location-changed")))}},ze="object"==typeof self?self:globalThis,Fe=e=>((e,t)=>{const i=(t,i)=>(e.set(i,t),t),s=o=>{if(e.has(o))return e.get(o);const[n,r]=t[o];switch(n){case 0:case-1:return i(r,o);case 1:{const e=i([],o);for(const t of r)e.push(s(t));return e}case 2:{const e=i({},o);for(const[t,i]of r)e[s(t)]=s(i);return e}case 3:return i(new Date(r),o);case 4:{const{source:e,flags:t}=r;return i(new RegExp(e,t),o)}case 5:{const e=i(new Map,o);for(const[t,i]of r)e.set(s(t),s(i));return e}case 6:{const e=i(new Set,o);for(const t of r)e.add(s(t));return e}case 7:{const{name:e,message:t}=r;return i(new ze[e](t),o)}case 8:return i(BigInt(r),o);case"BigInt":return i(Object(BigInt(r)),o);case"ArrayBuffer":return i(new Uint8Array(r).buffer,r);case"DataView":{const{buffer:e}=new Uint8Array(r);return i(new DataView(e),r)}}return i(new ze[n](r),o)};return s})(new Map,e)(0),Ke="",{toString:We}={},{keys:Je}=Object,Ze=e=>{const t=typeof e;if("object"!==t||!e)return[0,t];const i=We.call(e).slice(8,-1);switch(i){case"Array":return[1,Ke];case"Object":return[2,Ke];case"Date":return[3,Ke];case"RegExp":return[4,Ke];case"Map":return[5,Ke];case"Set":return[6,Ke];case"DataView":return[1,i]}return i.includes("Array")?[1,i]:i.includes("Error")?[7,i]:[2,i]},Xe=([e,t])=>0===e&&("function"===t||"symbol"===t),et=(e,{json:t,lossy:i}={})=>{const s=[];return((e,t,i,s)=>{const o=(e,t)=>{const o=s.push(e)-1;return i.set(t,o),o},n=s=>{if(i.has(s))return i.get(s);let[r,a]=Ze(s);switch(r){case 0:{let t=s;switch(a){case"bigint":r=8,t=s.toString();break;case"function":case"symbol":if(e)throw new TypeError("unable to serialize "+a);t=null;break;case"undefined":return o([-1],s)}return o([r,t],s)}case 1:{if(a){let e=s;return"DataView"===a?e=new Uint8Array(s.buffer):"ArrayBuffer"===a&&(e=new Uint8Array(s)),o([a,[...e]],s)}const e=[],t=o([r,e],s);for(const t of s)e.push(n(t));return t}case 2:{if(a)switch(a){case"BigInt":return o([a,s.toString()],s);case"Boolean":case"Number":case"String":return o([a,s.valueOf()],s)}if(t&&"toJSON"in s)return n(s.toJSON());const i=[],l=o([r,i],s);for(const t of Je(s))!e&&Xe(Ze(s[t]))||i.push([n(t),n(s[t])]);return l}case 3:return o([r,s.toISOString()],s);case 4:{const{source:e,flags:t}=s;return o([r,{source:e,flags:t}],s)}case 5:{const t=[],i=o([r,t],s);for(const[i,o]of s)(e||!Xe(Ze(i))&&!Xe(Ze(o)))&&t.push([n(i),n(o)]);return i}case 6:{const t=[],i=o([r,t],s);for(const i of s)!e&&Xe(Ze(i))||t.push(n(i));return i}}const{message:l}=s;return o([r,{name:a,message:l}],s)};return n})(!(t||i),!!t,new Map,s)(e),s};var tt="function"==typeof structuredClone?(e,t)=>t&&("json"in t||"lossy"in t)?Fe(et(e,t)):structuredClone(e):(e,t)=>Fe(et(e,t));function it(e){return e?(delete(e=tt(e)).type,e.popup_card_id&&delete e.popup_card_id,e.entity&&delete e.entity,e.target&&delete e.target,e):e}function st(e,t,i,s){var o,n,r,a;if("custom:popup-card"!==e.type)return!1;const l=je((null===(o=e.target)||void 0===o?void 0:o.entity_id)||[]),d=e.entity&&!l.includes(e.entity)?[...l,e.entity]:l,c=je((null===(n=e.target)||void 0===n?void 0:n.area_id)||[]),h=je((null===(r=e.target)||void 0===r?void 0:r.label_id)||[]),u=je((null===(a=e.target)||void 0===a?void 0:a.device_id)||[]);return(d.some(e=>e===t.entity_id)||c.some(e=>e===t.area_id)||h.some(e=>t.labels.includes(e))||u.some(e=>e===t.device_id))&&(i===s||e.popup_card_all_views)}function ot(e,t){for(const i of e.views){if(i.cards)for(const e of i.cards){if(e.popup_card_id===t)return e;if(e.cards)for(const i of e.cards)if(i.popup_card_id===t)return i}if(i.sections)for(const e of i.sections)if(e.cards)for(const i of e.cards){if(i.popup_card_id===t)return i;if(i.cards)for(const e of i.cards)if(e.popup_card_id===t)return e}}return null}const nt=e=>class extends e{constructor(){super();const e=["sequence","delay","popup","more_info","close_popup","set_popup_style","notification","navigate","refresh","change_browser_id","set_theme","console","javascript"];for(const t of e)this.addEventListener(`command-${t}`,e=>{this.service(t,e.detail)});document.body.addEventListener("ll-custom",e=>{e.detail.browser_mod&&this._service_action(e.detail.browser_mod)})}async service(e,t){this._service_action({service:e,data:t,target:{}})}async _service_action({service:e,data:t,target:i}){var s,o,n;if(t=void 0===t?{}:tt(t),!e)return void console.error("Browser Mod: Service parameter not specified in service call.");let r=e;if(!r.startsWith("browser_mod.")&&r.includes(".")||void 0!==t.browser_id||void 0!==t.user_id){const e=Object.assign({},t),s=Object.assign({},i);"THIS"===e.browser_id&&(e.browser_id=this.browserID),"THIS"===e.user_id&&this.user&&(e.user_id=this.user.id),"THIS"===e.browser_entities&&(e.browser_entities=this.browserEntities);const[o,n]=r.split(".");return this.hass.callService(o,n,e,s)}switch(r.startsWith("browser_mod.")&&(r=r.substring(12)),r){case"sequence":for(const e of t.sequence)await this._service_action(e);break;case"delay":await new Promise(e=>setTimeout(e,t.time));break;case"more_info":const{entity:e,view:i,large:r,ignore_popup_card:u,close:p}=t;this.showMoreInfo(e,i,r,u,p);break;case"popup":if(t.popup_card_id){const e=await xe(document),i=await async function(e,t){var i;const s=null===(i=null==e?void 0:e.lovelace)||void 0===i?void 0:i.config;var o=void 0,n=void 0;t.includes("/")?[n,o]=t.split("/"):o=t;var r=null;if(s&&o&&!n)r=ot(s,o);else if(o&&n&&window.browser_mod.connection){var a;try{a=await window.browser_mod.connection.sendMessagePromise({type:"lovelace/config",url_path:n})}catch(e){a=null}a&&(r=ot(a,o))}return it(r)}(e,t.popup_card_id);if(i){let e=Object.assign({},i);delete e.card,t=Object.assign(Object.assign({content:i.card},e),t)}}t.icons&&t.icons.forEach((e,i)=>{t[`icon_${i}_action`]=e.action});const{title:_,content:v}=t,g=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(s=Object.getOwnPropertySymbols(e);o<s.length;o++)t.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(e,s[o])&&(i[s[o]]=e[s[o]])}return i}(t,["title","content"]);for(const[e,t]of Object.entries(g))if(e.endsWith("_action")){let i=t;g[e]=e=>{Array.isArray(i)||(i=[i]),i.forEach(t=>{var{action:i,service:s,target:o,data:n}=t;s=void 0===i||"call-service"===i?s:i,this._service_action({service:s,target:o,data:Object.assign(Object.assign({},n),e)})})}}g.icons&&(g.icons=tt(g.icons),g.icons.forEach((e,t)=>{g.icons[t].action=g[`icon_${t}_action`],delete g[`icon_${t}_action`]})),this.showPopup(Object.assign({title:_,content:v},g));break;case"notification":{t.action_action=t.action,delete t.action;var{message:a,action_text:l,action_action:d,duration:c,dismissable:h}=t;let e;l&&l.trim()&&(e={text:l,action:e=>{d&&l&&(Array.isArray(d)||(d=[d]),d.forEach(t=>{var{action:i,service:s,target:o,data:n}=t;s=void 0===i||"call-service"===i?s:i,this._service_action({service:s,target:o,data:Object.assign(Object.assign({},n),e)})}))}});(await qe()).dispatchEvent(new CustomEvent("hass-notification",{detail:{message:a,action:e,duration:c,dismissable:h}}))}break;case"close_popup":await this.closePopup(t);break;case"set_popup_style":this.setPopupStyle(t);break;case"navigate":this.browser_navigate(t.path);break;case"refresh":if(window.caches){let e=[];(await window.caches.keys()).forEach(t=>{e.push(window.caches.delete(t))}),await Promise.all(e),window.location.reload()}else window.location.href=window.location.href;break;case"change_browser_id":{const{current_browser_id:e,new_browser_id:i,register:r,refresh:a}=t;if(void 0===e&&void 0===i){const e="Change Browser ID",t=Object.keys(this.browsers),i=[{name:"current_browser_id",label:"Current Browser ID",selector:{text:null},default:this.browserID,disabled:!0},{name:"new_browser_id",label:"New Browser ID",selector:{select:{options:t,custom_value:!0,sort:!0}}},{name:"register",label:"Register",selector:{boolean:null},default:this.registered},{name:"refresh",label:"Refresh",selector:{boolean:null},default:null==a||a}],o={left_button:"Cancel",right_button:"Change",right_button_variant:"danger",right_button_appearance:"accent",right_button_action:e=>{this.fireBrowserEvent("command-change_browser_id",e)}};null===(s=window.browser_mod)||void 0===s||s.showPopup(Object.assign({title:e,content:i},o))}else{let t=!1;if(e&&this.browserID===e)t=!0;else{const i=null===(n=null===(o=this.hass)||void 0===o?void 0:o.devices[e])||void 0===n?void 0:n.identifiers;Array.isArray(i)&&i.length>0&&Array.isArray(i[0])&&i[0].includes(this.browserID)&&(t=!0)}if(t){if(i&&"string"==typeof i){const e=i.trim();""!==e&&e!==this.browserID&&(this.browserID=e)}void 0!==r&&this.registered!==r&&(this.registered=r),a&&window.setTimeout(()=>{this.fireBrowserEvent("command-refresh",{})},100)}}}break;case"set_theme":{const e=Object.assign({},t);if("auto"===e.theme&&(e.theme=void 0),"auto"===e.dark&&(e.dark=void 0),"light"===e.dark&&(e.dark=!1),"dark"===e.dark&&(e.dark=!0),e.primaryColor&&Array.isArray(e.primaryColor)){const[t,i,s]=e.primaryColor;e.primaryColor="#"+((1<<24)+(t<<16)+(i<<8)+s).toString(16).slice(1)}if(e.accentColor&&Array.isArray(e.accentColor)){const[t,i,s]=e.accentColor;e.accentColor="#"+((1<<24)+(t<<16)+(i<<8)+s).toString(16).slice(1)}(await qe()).dispatchEvent(new CustomEvent("settheme",{detail:e}))}break;case"console":Object.keys(t).length>1||t&&void 0===t.message?console.dir(t):console.log(t.message);break;case"javascript":const m=async()=>{let e=await xe(document);e&&e.dispatchEvent(new CustomEvent("config-refresh"))},b=async e=>this.connection.sendMessage({type:"browser_mod/log",message:e}),w=`\n          "use strict";\n          ${t.code}\n          `;new Function("hass","data","service","log","lovelace_reload",w)(this.hass,t,window.browser_mod.service,b,m)}}},rt=["onMotion"],at=e=>class extends e{constructor(){super(),this.activityTriggered=!1,this._activityCooldown=15e3;for(const e of["pointerdown","pointermove","keydown"])window.addEventListener(e,()=>this.activityTrigger(!0));this.addEventListener("fully-update",e=>{var t,i;rt.includes(null===(t=e.detail)||void 0===t?void 0:t.event)&&this.activityTrigger(!1,`fully${Be(null===(i=e.detail)||void 0===i?void 0:i.event)}`)}),this.addEventListener("browser-mod-ready",()=>this._activity_state_update())}_activity_state_update(){this.sendUpdate({activity:this.activityTriggered})}activityTrigger(e=!1,t="userInteraction"){this.activityTriggered||this.sendUpdate({activity:!0,activityType:t}),this.activityTriggered=!0,e&&this.fireBrowserEvent("browser-mod-activity"),clearTimeout(this._activityTimeout),this._activityTimeout=setTimeout(()=>this.activityReset(),this._activityCooldown)}activityReset(){clearTimeout(this._activityTimeout),this.activityTriggered&&this.sendUpdate({activity:!1,activityType:"none"}),this.activityTriggered=!1}},lt=2,dt=e=>(...t)=>({_$litDirective$:e,values:t});let ct=class{constructor(e){}get _$AU(){return this._$AM._$AU}_$AT(e,t,i){this._$Ct=e,this._$AM=t,this._$Ci=i}_$AS(e,t){return this.update(e,t)}update(e,t){return this.render(...t)}};class ht extends ct{constructor(e){if(super(e),this.it=V,e.type!==lt)throw Error(this.constructor.directiveName+"() can only be used in child bindings")}render(e){if(e===V||null==e)return this._t=void 0,this.it=e;if(e===G)return e;if("string"!=typeof e)throw Error(this.constructor.directiveName+"() called with a non-string value");if(e===this.it)return this._t;this.it=e;const t=[e];return t.raw=t,this._t={_$litType$:this.constructor.resultType,strings:t,values:[]}}}ht.directiveName="unsafeHTML",ht.resultType=1;const ut=dt(ht),{I:pt}=oe,_t=()=>document.createComment(""),vt=(e,t,i)=>{const s=e._$AA.parentNode,o=void 0===t?e._$AB:t._$AA;if(void 0===i){const t=s.insertBefore(_t(),o),n=s.insertBefore(_t(),o);i=new pt(t,n,e,e.options)}else{const t=i._$AB.nextSibling,n=i._$AM,r=n!==e;if(r){let t;i._$AQ?.(e),i._$AM=e,void 0!==i._$AP&&(t=e._$AU)!==n._$AU&&i._$AP(t)}if(t!==o||r){let e=i._$AA;for(;e!==t;){const t=e.nextSibling;s.insertBefore(e,o),e=t}}}return i},gt=(e,t,i=e)=>(e._$AI(t,i),e),mt={},bt=e=>{e._$AR(),e._$AA.remove()},wt=(e,t,i)=>{const s=new Map;for(let o=t;o<=i;o++)s.set(e[o],o);return s},ft=dt(class extends ct{constructor(e){if(super(e),e.type!==lt)throw Error("repeat() can only be used in text expressions")}dt(e,t,i){let s;void 0===i?i=t:void 0!==t&&(s=t);const o=[],n=[];let r=0;for(const t of e)o[r]=s?s(t,r):r,n[r]=i(t,r),r++;return{values:n,keys:o}}render(e,t,i){return this.dt(e,t,i).values}update(e,[t,i,s]){const o=(e=>e._$AH)(e),{values:n,keys:r}=this.dt(t,i,s);if(!Array.isArray(o))return this.ut=r,n;const a=this.ut??=[],l=[];let d,c,h=0,u=o.length-1,p=0,_=n.length-1;for(;h<=u&&p<=_;)if(null===o[h])h++;else if(null===o[u])u--;else if(a[h]===r[p])l[p]=gt(o[h],n[p]),h++,p++;else if(a[u]===r[_])l[_]=gt(o[u],n[_]),u--,_--;else if(a[h]===r[_])l[_]=gt(o[h],n[_]),vt(e,l[_+1],o[h]),h++,_--;else if(a[u]===r[p])l[p]=gt(o[u],n[p]),vt(e,o[h],o[u]),u--,p++;else if(void 0===d&&(d=wt(r,p,_),c=wt(a,h,u)),d.has(a[h]))if(d.has(a[u])){const t=c.get(r[p]),i=void 0!==t?o[t]:null;if(null===i){const t=vt(e,o[h]);gt(t,n[p]),l[p]=t}else l[p]=gt(i,n[p]),vt(e,o[h],i),o[t]=null;p++}else bt(o[u]),u--;else bt(o[h]),h++;for(;p<=_;){const t=vt(e,l[_+1]);gt(t,n[p]),l[p++]=t}for(;h<=u;){const e=o[h++];null!==e&&bt(e)}return this.ut=r,((e,t=mt)=>{e._$AH=t})(e,l),G}}),yt=e=>e??V;class At{constructor(e,t,i){this._settingsValid=!0,this._showErrors=!1,this._objectSelectors=void 0,this._debounceShowErrors=Oe(()=>{this._settingsValid||(this.showErrors=!0)},2e3),this._formObjectSelectors=e=>{var t,i,s=[];const o=null===(t=null==e?void 0:e.shadowRoot)||void 0===t?void 0:t.querySelectorAll("ha-selector");null==o||o.forEach(e=>{if(null==e?void 0:e.selector.hasOwnProperty("object")){const t={element:e,name:e.name,label:e.label};s.push(t)}});const n=null===(i=null==e?void 0:e.shadowRoot)||void 0===i?void 0:i.querySelectorAll("ha-form-grid, ha-form-expandable");return null==n||n.forEach(e=>{if(e.shadowRoot){e.shadowRoot.querySelectorAll("ha-form").forEach(e=>{const t=this._formObjectSelectors(e);s.push(...t)})}}),s},this.element=e,this._settingsValidCallback=t,this._showErrorsCallback=i}get objectSelectors(){var e;return null!==(e=this._objectSelectors)&&void 0!==e?e:[]}set showErrors(e){var t;this._showErrors=e,null===(t=this._showErrorsCallback)||void 0===t||t.call(this,e)}get showErrors(){return this._showErrors}set settingsValid(e){var t;this._settingsValid=e,null===(t=this._settingsValidCallback)||void 0===t||t.call(this,e)}get settingsValid(){return this._settingsValid}startMonitoring(){var e,t;void 0===this._objectSelectors&&(this._objectSelectors=this._formObjectSelectors(null===(t=null===(e=this.element)||void 0===e?void 0:e.shadowRoot)||void 0===t?void 0:t.querySelector("ha-form"))),this.objectSelectors.map(e=>{var t;null===(t=e.element)||void 0===t||t.addEventListener("value-changed",t=>{e.isValid=t.detail.isValid,e.errorMsg=t.detail.errorMsg,this.settingsValid=this.objectSelectors.every(e=>!1!==e.isValid),this.settingsValid?(this.showErrors=!1,this._debounceShowErrors.cancel()):this._debounceShowErrors()},{capture:!0})})}stopMonitoring(){this.objectSelectors.map(e=>{var t;null===(t=e.element)||void 0===t||t.removeEventListener("value-changed",()=>{})}),this.showErrors=!1,this.settingsValid=!0,this._objectSelectors=void 0,this._debounceShowErrors.cancel()}}class Et extends ae{connectedCallback(){super.connectedCallback(),this._objectSelectorMonitor=new At(this,e=>{this._formDataValid=e}),this._styleAttributes=this._styleAttributes||[],Object.keys(this._styleAttributes).forEach(e=>{this._styleAttributes[e]=!1})}updated(e){super.updated(e),e.has("_styleAttributes")&&Object.keys(this._styleAttributes).forEach(e=>{this._styleAttributes[e]?e.split(" ").forEach(e=>this.setAttribute(e,"")):e.split(" ").forEach(e=>this.removeAttribute(e))})}async showDialog(e){const t=e.title,i=e.content;e.title&&delete e.title,e.content&&delete e.content,await this.setupDialog(t,i,e),this.openDialog()}async closeDialog(){var e,t,i,s,o;return!this.open||(this.open=!1,this._objectSelectorMonitor.stopMonitoring(),null===(t=null===(e=this.card)||void 0===e?void 0:e.remove)||void 0===t||t.call(e),this.card=void 0,clearInterval(this._timeoutTimer),this._autocloseListener&&(window.browser_mod.removeEventListener("browser-mod-activity",this._autocloseListener),this._autocloseListener=void 0),null===(s=null===(i=this._actions)||void 0===i?void 0:i.dismiss_action)||void 0===s||s.call(i),(null===(o=this._cardMod)||void 0===o?void 0:o[0])&&(this._cardMod[0].styles=""),window.browser_mod.dispatchEvent(new CustomEvent("browser-mod-popup-closed",{detail:{popup:this}})),Object.keys(this._styleAttributes).forEach(e=>{e.split(" ").forEach(e=>this.removeAttribute(e))}),this._styleSequenceIndex=void 0,!0)}openDialog(){var e;this.open=!0,null===(e=this.dialog)||void 0===e||e.show(),this.timeout&&(this._timeoutStart=(new Date).getTime(),this._timeoutTimer=setInterval(()=>{const e=(new Date).getTime()-this._timeoutStart,t=e/this.timeout*100;this.timeout_hide_progress||this.style.setProperty("--progress",`${t}%`),e>=this.timeout&&(clearInterval(this._timeoutTimer),this._timeout())},10)),this._autocloseListener=void 0,this._autoclose&&(this._autocloseListener=()=>this.dialog.close(),window.browser_mod.addEventListener("browser-mod-activity",this._autocloseListener,{once:!0})),customElements.whenDefined("card-mod").then(()=>{var e,t,i,s,o,n,r;null===(t=null===(e=customElements.get("card-mod"))||void 0===e?void 0:e.applyToElement)||void 0===t||t.call(e,this,this.tag?`browser-mod-popup-${this.tag}`:"more-info",(null===(i=this.card_mod)||void 0===i?void 0:i.style)?{style:this.card_mod.style,debug:null!==(o=null===(s=this.card_mod)||void 0===s?void 0:s.debug)&&void 0!==o&&o}:{style:"{}",debug:null!==(r=null===(n=this.card_mod)||void 0===n?void 0:n.debug)&&void 0!==r&&r},{},!0,"browser_mod-card_mod")}),this.updateComplete.then(()=>{this.card&&Ce(this.content,"$").then(e=>{if(!e)return;const t=document.createElement("style");t.classList.add("browser-mod-style"),t.innerHTML="\n          ha-card {\n            box-shadow: none !important;\n            border: none !important;\n          }",e.appendChild(t)}),this._formdata&&setTimeout(()=>this._objectSelectorMonitor.startMonitoring(),0)}),window.browser_mod.dispatchEvent(new CustomEvent("browser-mod-popup-opened",{detail:{popup:this}}))}_updateStyleAttributes(e){var t;"initial"==e&&(e=this._initialStyle),Object.keys(this._styleAttributes).forEach(e=>{this._styleAttributes[e]=!1}),this._styleAttributes[e]=!0,null===(t=this._popupStyles)||void 0===t||t.forEach(t=>{var i;t.style===e&&(null===(i=t.include_styles)||void 0===i||i.forEach(e=>{this._styleAttributes[e]=!0}))}),this._styleAttributes=tt(this._styleAttributes)}_setStyleAttribute(e){this._updateStyleAttributes(e),this._styleSequenceIndex=this._styleSequence.indexOf(e)}_cycleStyleAttributes(e="forward"){this._styleSequenceIndex="forward"===e?(this._styleSequenceIndex+1)%this._styleSequence.length:(this._styleSequenceIndex-1+this._styleSequence.length)%this._styleSequence.length,this._updateStyleAttributes(this._styleSequence[this._styleSequenceIndex])}async _build_card(e){const t=await window.loadCardHelpers(),i=await t.createCardElement(e);i.hass=window.browser_mod.hass,Me(i),this.content=i,customElements.get(i.localName)||customElements.whenDefined(i.localName).then(()=>{this._build_card(e)}),i.addEventListener("ll-rebuild",()=>{this._build_card(e)})}_setFormdata(e){for(const t of e)t.schema?this._setFormdata(t.schema):t.name&&void 0!==t.default&&(this._formdata[t.name]=t.default)}async setupDialog(e,t,{right_button:i,right_button_variant:s="brand",right_button_appearance:o="plain",right_button_action:n,right_button_close:r=!0,left_button:a,left_button_variant:l="brand",left_button_appearance:d="plain",left_button_action:c,left_button_close:h=!0,dismissable:u=!0,dismiss_action:p,timeout:_,timeout_action:v,timeout_hide_progress:g,size:m,initial_style:b,style:w,autoclose:f=!1,card_mod:y,icon:A,icon_title:E,icon_action:$,icon_close:S=!0,icon_class:C,icons:x,dismiss_icon:q,tag:I,popup_styles:M,style_sequence:k}={}){var T;if(this._formdata=void 0,this._formDataValid=!0,this.title=e,this.card=void 0,this.card_mod=y,this._initialStyle=null!==(T=null!=b?b:m)&&void 0!==T?T:"normal",this._popupStyles=M,this._styleSequence=je(null!=k?k:[]),this._styleSequence=this._styleSequence.length>0?this._styleSequence:["wide","normal"],this._setStyleAttribute(this._initialStyle),t&&t instanceof HTMLElement)this.content=t;else if(t&&Array.isArray(t)){Te();const e=document.createElement("ha-form");e.schema=t,e.computeLabel=e=>{var t;return null!==(t=e.label)&&void 0!==t?t:e.name},e.hass=window.browser_mod.hass,this._formdata={},this._setFormdata(t),e.data=this._formdata,Me(e),e.addEventListener("value-changed",t=>{this._formdata=Object.assign({},t.detail.value),e.data=this._formdata}),e.addEventListener("closing",e=>{e.stopPropagation(),e.preventDefault()}),this.content=e}else t&&"object"==typeof t?(this.card=!0,await this._build_card(t)):this.content=ut(t);if(this.right_button=i,this.right_button_variant=s,this.right_button_appearance=o,this.right_button_close=r,this.left_button=a,this.left_button_variant=l,this.left_button_appearance=d,this.right_button_close=r,this.left_button=a,this.left_button_variant=l,this.left_button_appearance=d,this.left_button_close=h,this.actions=void 0===i?void 0:"",this.dismissable=u,this.dismiss_icon=q,this.timeout=_,this.timeout_hide_progress=g,this._actions={right_button_action:n,left_button_action:c,dismiss_action:p,timeout_action:v},this.tag=I,this._style=w,this._autoclose=f,x){this.icons=[];const e={icon:void 0,title:void 0,action:void 0,close:!0,class:void 0};x.forEach((t,i)=>{this.icons[i]=Object.assign(Object.assign({},e),t)})}else this.icons=A?[{icon:A,title:E,action:$,close:S,class:C}]:[]}async do_close(){var e,t,i;const s=null===(e=this._actions)||void 0===e?void 0:e.dismiss_action;(null===(t=this._actions)||void 0===t?void 0:t.dismiss_action)&&(this._actions.dismiss_action=void 0),await(null===(i=this.dialog)||void 0===i?void 0:i.close()),null==s||s(this._formdata),this._objectSelectorMonitor.stopMonitoring()}async _primary(){var e,t,i;(null===(e=this._actions)||void 0===e?void 0:e.dismiss_action)&&(this._actions.dismiss_action=void 0),!0===this.right_button_close&&await this.do_close(),null===(i=null===(t=this._actions)||void 0===t?void 0:t.right_button_action)||void 0===i||i.call(t,this._formdata)}async _secondary(){var e,t,i;(null===(e=this._actions)||void 0===e?void 0:e.dismiss_action)&&(this._actions.dismiss_action=void 0),!0===this.left_button_close&&await this.do_close(),null===(i=null===(t=this._actions)||void 0===t?void 0:t.left_button_action)||void 0===i||i.call(t,this._formdata)}async _timeout(){var e,t,i;(null===(e=this._actions)||void 0===e?void 0:e.dismiss_action)&&(this._actions.dismiss_action=void 0),await this.do_close(),null===(i=null===(t=this._actions)||void 0===t?void 0:t.timeout_action)||void 0===i||i.call(t)}async _icon_action(e){var t,i,s,o,n,r;(null===(t=this._actions)||void 0===t?void 0:t.dismiss_action)&&(this._actions.dismiss_action=void 0),(null===(s=null===(i=this.icons)||void 0===i?void 0:i[e])||void 0===s?void 0:s.close)&&await this.do_close(),await(null===(r=null===(n=null===(o=this.icons)||void 0===o?void 0:o[e])||void 0===n?void 0:n.action)||void 0===r?void 0:r.call(n))}render(){return this.open?Y`
      <ha-dialog
        open
        @closed=${this.closeDialog}
        .heading=${void 0!==this.title}
        hideActions
        flexContent
        .scrimClickAction=${this.dismissable?"close":""}
        .escapeKeyAction=${this.dismissable?"close":""}
      >
        ${this.timeout&&!this.timeout_hide_progress?Y` <div slot="heading" class="progress"></div> `:""}
        ${this.title?Y`
              <ha-dialog-header slot="heading">
                ${this.dismissable?Y`
                      <ha-icon-button
                        dialogAction="cancel"
                        slot="navigationIcon"
                      >
                        <ha-icon 
                          .icon=${this.dismiss_icon||"mdi:close"}>
                        </ha-icon>
                      </ha-icon-button>
                    `:""}
                <span 
                  slot="title" 
                  @click=${()=>{this._cycleStyleAttributes()}} 
                  .title="${this.title}"
                  class="title"
                >${this.title}</span>
                ${this.icons?ft(this.icons,(e,t)=>{var i;return Y`
                        <ha-icon-button
                          slot="actionItems"
                          title=${null!==(i=e.title)&&void 0!==i?i:""}
                          @click=${()=>{this.blur(),this._icon_action(t)}}
                          class=${yt(e.class)}
                        >
                          <ha-icon .icon=${e.icon}></ha-icon>
                        </ha-icon-button>
                      `}):""}
              </ha-dialog-header>
            `:Y``}

        <div class="content" tabindex="-1" dialogInitialFocus>
          <div class="container">${this.content}</div>
          ${void 0!==this.right_button||void 0!==this.left_button?Y`
                <div class="buttons">
                  ${void 0!==this.left_button?Y`
                        <ha-button
                          variant=${this.left_button_variant}
                          appearance=${this.left_button_appearance}
                          @click=${this._secondary}
                          class="action-button"
                        >${this.left_button}</ha-button>
                      `:Y`<div></div>`}
                  ${void 0!==this.right_button?Y`
                        <ha-button
                          variant=${this.right_button_variant}
                          appearance=${this.right_button_appearance}
                          @click=${this._primary}
                          class="action-button"
                          ?disabled=${!this._formDataValid}
                        >${this.right_button}</ha-button>
                      `:""}
                </div>
              `:""}
        </div>
        <style>
          ${this.getDynamicStyles()}
        </style>
      </ha-dialog>
    `:Y``}getDynamicStyles(){var e,t;return`\n      :host {\n        ${null!==(e=this._style)&&void 0!==e?e:""}\n      }\n      ${null===(t=this._popupStyles)||void 0===t?void 0:t.filter(e=>e.styles).map(e=>"all"==e.style?`:host {\n          ${e.styles}\n        }`:`:host([${e.style}]) {\n          ${e.styles}\n        }`).join("\n")}\n    `}static get styles(){return a`
      /* Classes from haStyleDialog */
      ha-dialog {
        --mdc-dialog-min-width: var(--popup-min-width, 560px);
        --mdc-dialog-min-width: var(--popup-min-width, min(560px, 95vw));
        --mdc-dialog-max-width: var(--popup-max-width, 600px);
        --mdc-dialog-max-width: var(--popup-max-width, min(600px, 95vw));
        --justify-action-buttons: space-between;
      }

      ha-dialog .form {
        color: var(--primary-text-color);
      }

      a {
        color: var(--primary-color);
      }

      ha-dialog {
        --vertical-align-dialog: flex-start;
        --dialog-surface-margin-top: 40px;
        --dialog-content-padding: 0;

        --ha-dialog-border-radius: var(--popup-border-radius, 28px);
        --padding-x: var(--popup-padding-x, 24px);
        --padding-y: var(--popup-padding-y, 20px);
      }
      .content {
        -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
        -webkit-focus-ring-color: rgba(0, 0, 0, 0);
        outline: none !important;
      }
      .content .container {
        padding: 8px 24px 20px 24px;
        -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
        -webkit-focus-ring-color: rgba(0, 0, 0, 0);
        outline: none !important;
      }
      :host([card]) .content .container {
        padding: 8px 8px 20px 8px;
      }
      .content .buttons {
        box-sizing: border-box;
        display: flex;
        padding: 8px 16px 8px 24px;
        justify-content: space-between;
        padding-bottom: 8px;
        background-color: var(--ha-dialog-surface-background, var(--mdc-theme-surface, #fff));
        border-top: 1px solid var(--divider-color);
        position: sticky;
        bottom: 0px;
      }
      .progress {
        position: relative;
      }

      .progress::before {
        content: "";
        position: absolute;
        left: 0;
        width: calc(100% - var(--progress, 60%));
        top: 0;
        height: 5px;
        background: var(--primary-color);
        z-index: 10;
      }
      .title {
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        -webkit-user-select: none;
        user-select: none;
        color: var(--primary-text-color);
      }

      ha-icon-button > * {
        display: flex;
      }

      ha-dialog-header > span {
        overflow: hidden;
        text-overflow: ellipsis;
        cursor: default;
      }

      :host([wide]) ha-dialog {
        --mdc-dialog-max-width: 90vw;
      }
      :host([wide]) .content {
        width: max(var(--mdc-dialog-min-width), calc(var(--mdc-dialog-max-width) - 2 * var(--padding-x)));
      }

      :host([classic]) ha-dialog {
        --dialog-surface-margin-top: 40px;
        --mdc-dialog-min-height: 10%;
        --mdc-dialog-max-height: 100%;
        --vertical-align-dialog: flex-start;
        --ha-dialog-border-radius: var(--popup-border-radius, 28px);
      }

      :host([fullscreen]) ha-dialog {
        --mdc-dialog-min-width: 100vw;
        --mdc-dialog-max-width: 100vw;
        --mdc-dialog-min-height: 100%;
        --mdc-dialog-max-height: 100%;
        --mdc-shape-medium: 0px;
        --vertical-align-dialog: flex-end;
        --ha-dialog-border-radius: 0px;
        --dialog-surface-margin-top: 0px;
      }
      :host([fullscreen]) .content {
        height: calc(
          100vh - var(--header-height) - var(--footer-height) - 2 *
            var(--padding-y) - 16px
        );
      }

      @media all and (max-width: 450px), all and (max-height: 500px) {
        ha-dialog {
          --mdc-dialog-min-width: calc(
            100vw - env(safe-area-inset-right) - env(safe-area-inset-left)
          );
          --mdc-dialog-max-width: calc(
            100vw - env(safe-area-inset-right) - env(safe-area-inset-left)
          );
          --mdc-dialog-min-height: 100%;
          --mdc-dialog-max-height: 100%;
          --vertical-align-dialog: flex-end;
          --ha-dialog-border-radius: 0;
        }
        :host([wide]) .content {
          width: 100vw;
        }
      }

      @media all and (min-width: 600px) and (min-height: 501px) {
        ha-dialog {
          --dialog-surface-margin-top: 40px;
        }
      }
    `}}t([he()],Et.prototype,"open",void 0),t([he()],Et.prototype,"content",void 0),t([he()],Et.prototype,"title",void 0),t([he({reflect:!0})],Et.prototype,"actions",void 0),t([he({reflect:!0})],Et.prototype,"card",void 0),t([he()],Et.prototype,"right_button",void 0),t([he()],Et.prototype,"right_button_variant",void 0),t([he()],Et.prototype,"right_button_appearance",void 0),t([he()],Et.prototype,"right_button_close",void 0),t([he()],Et.prototype,"left_button",void 0),t([he()],Et.prototype,"left_button_variant",void 0),t([he()],Et.prototype,"left_button_appearance",void 0),t([he()],Et.prototype,"left_button_close",void 0),t([he()],Et.prototype,"dismissable",void 0),t([he({type:Array})],Et.prototype,"icons",void 0),t([he()],Et.prototype,"tag",void 0),t([he()],Et.prototype,"dismiss_icon",void 0),t([he({reflect:!0})],Et.prototype,"timeout_hide_progress",void 0),t([he()],Et.prototype,"_style",void 0),t([he()],Et.prototype,"_formDataValid",void 0),t([he({type:Array})],Et.prototype,"_styleAttributes",void 0),t([_e("ha-dialog")],Et.prototype,"dialog",void 0);const $t=e=>class extends e{constructor(){super(),this._popupElements=[],this.popupStateListener=e=>{var t;const i=null===(t=e.detail)||void 0===t?void 0:t.popup;i&&(("browser-mod-popup-closed"===e.type||this._popupElements.includes(i))&&(this._popupElements=this._popupElements.filter(e=>e!==i)),"browser-mod-popup-opened"===e.type&&this._popupElements.push(i))},ke(),this.addEventListener("browser-mod-popup-opened",this.popupStateListener),this.addEventListener("browser-mod-popup-closed",this.popupStateListener),this._popupState=!1}get openPopups(){return this._popupElements.filter(e=>!0===e.open).map(e=>void 0!==e.tag?e.tag:"standard")}get popupState(){return this._popupElements.some(e=>!0===e.open)}showPopup(e){(async()=>{const t=await qe(),i=e.tag?`browser-mod-popup-${e.tag}`:"browser-mod-popup";Ct(t,i,e)})()}async closePopup(e){var t;const{all:i,tag:s}=e;if(!0===i)this._popupElements.forEach(e=>e.closeDialog()),this._popupElements=[];else if("string"==typeof s){const e=""!=s?`browser-mod-popup-${s}`:"browser-mod-popup",t=this._popupElements.find(t=>t.nodeName.toLowerCase()===e);null==t||t.closeDialog()}else null===(t=this._popupElements.pop())||void 0===t||t.closeDialog()}async showMoreInfo(e,t="info",i=!1,s=void 0,o=!1){const n=await qe();if(o){const e=n.shadowRoot.querySelector("ha-more-info-dialog");return void(e&&e.closeDialog())}if(n.dispatchEvent(new CustomEvent("hass-more-info",{bubbles:!0,composed:!0,cancelable:!1,detail:{entityId:e,view:t,ignore_popup_card:s}})),i){await new Promise(e=>setTimeout(e,50));const e=n.shadowRoot.querySelector("ha-more-info-dialog");e&&(e.large=!0)}}setPopupStyle(e){const{all:t,tag:i,style:s,direction:o}=e;if(!0===t)this._popupElements.forEach(e=>{s?e._setStyleAttribute(s):e._cycleStyleAttributes(o)});else if("string"==typeof i){const e=""!=i?`browser-mod-popup-${i}`:"browser-mod-popup",t=this._popupElements.find(t=>t.nodeName.toLowerCase()===e);s?null==t||t._setStyleAttribute(s):null==t||t._cycleStyleAttributes(o)}else{const e=this._popupElements.slice(-1)[0];s?null==e||e._setStyleAttribute(s):null==e||e._cycleStyleAttributes(o)}}},St={};const Ct=(e,t,i)=>{!function(e){if(!St[e]){class t extends Et{}customElements.get(e)||customElements.define(e,t),St[e]=t}}(t),e.dispatchEvent(new CustomEvent("show-dialog",{detail:{dialogTag:t,dialogImport:()=>customElements.whenDefined(t),dialogParams:i}}))};var xt="2.7.2";const qt=["normal","classic","wide","fullscreen"],It=[{name:"popup_card_id",label:"Popup-card ID",selector:{text:{}}},{name:"target",label:"Targets",selector:{target:{}}},{name:"entity",label:"Entity (deprecated, use target instead)",selector:{entity:{}}},{name:"title",label:"Title",selector:{text:{}}},{type:"expandable",label:"Header icon",schema:[{label:"Multiple icons can be specified as a yaml list. Refer to Browser Mod documentation.",type:"constant"},{name:"icon",label:"Icon",selector:{icon:{}}},{name:"icon_title",label:"Icon title",selector:{text:{}}},{name:"icon_action",label:"Icon action",selector:{object:{}}},{name:"icon_close",label:"Icon closes popup",default:!0,selector:{boolean:{}}},{name:"icon_class",label:"Icon class",selector:{text:{}}}]},{type:"expandable",label:"Popup styles",schema:[{label:"Multiple popup styles can be applied for use with title tap or\n        `browser_mod.set_popup_style`. You may add styles for `normal`, `classic`,\n        `wide`, `fullscreen` or add your own style. Two special styles of `all` and  `card`\n        are also available. `all` is always applied. `card` is applied when the popup content is a card.",type:"constant"},{name:"initial_style",label:"Initial style",selector:{select:{mode:"dropdown",custom_value:!0,options:qt}}},{name:"style_sequence",label:"Style sequence",selector:{select:{mode:"dropdown",custom_value:!0,multiple:!0,options:["initial",...qt]}}},{name:"popup_styles",label:"Popup CSS styles",selector:{object:{label_field:"style",description_field:"include_styles",multiple:!0,fields:{style:{label:"Style",required:!0,selector:{select:{mode:"dropdown",custom_value:!0,options:[...qt,"card","all"]}}},include_styles:{label:"Also apply styles from...",selector:{select:{mode:"dropdown",custom_value:!0,multiple:!0,options:qt}}},styles:{label:"CSS Styles",selector:{text:{multiline:!0}}}}}}}]},{name:"size",label:"Popup size (deprecated, use popup style `initial_style` instead)",selector:{select:{mode:"dropdown",options:qt}}},{type:"grid",schema:[{name:"right_button",label:"Right button",selector:{text:{}}},{name:"left_button",label:"Left button",selector:{text:{}}}]},{type:"grid",schema:[{name:"right_button_variant",label:"Right button variant",selector:{select:{mode:"dropdown",options:["brand","neutral","danger","warning","success"]}}},{name:"left_button_variant",label:"Left button variant",selector:{select:{mode:"dropdown",options:["brand","neutral","danger","warning","success"]}}}]},{type:"grid",schema:[{name:"right_button_appearance",label:"Right button appearance",selector:{select:{mode:"dropdown",options:["accent","filled","outlined","plain"]}}},{name:"left_button_appearance",label:"Left button appearance",selector:{select:{mode:"dropdown",options:["accent","filled","outlined","plain"]}}}]},{type:"grid",schema:[{name:"right_button_action",label:"Right button action",selector:{object:{}}},{name:"left_button_action",label:"Left button action",selector:{object:{}}}]},{type:"grid",schema:[{name:"right_button_close",label:"Right button closes popup",default:!0,selector:{boolean:{}}},{name:"left_button_close",label:"Left button closes popup",default:!0,selector:{boolean:{}}}]},{type:"grid",schema:[{name:"dismissable",label:"User dismissable",selector:{boolean:{}}},{name:"timeout",label:"Auto close timeout (ms)",selector:{number:{mode:"box"}}}]},{name:"timeout_hide_progress",label:"Hide timeout progress bar",selector:{boolean:{}}},{type:"grid",schema:[{name:"dismiss_action",label:"Dismiss action",selector:{object:{}}},{name:"timeout_action",label:"Timeout action",selector:{object:{}}}]},{name:"popup_card_all_views",label:"Popup card is available for use in all views",default:!1,selector:{boolean:{}}},{name:"style",label:"CSS style (deprecated, use popup style `all` instead)",selector:{text:{multiline:!0}}},{type:"expandable",label:"Multiple popups",schema:[{name:"tag",label:"Tag",selector:{text:{}}},{name:"dismiss_icon",label:"Popup dismiss/close icon",selector:{icon:{}}}]}];class Mt extends ae{constructor(){super(...arguments),this._selectedTab=0,this._cardGUIMode=!0,this._cardGUIModeAvailable=!0,this._settingsValid=!0,this._showErrors=!1}get settingsValid(){return this._settingsValid}get showErrors(){return this._showErrors}setConfig(e){this._config=e}connectedCallback(){super.connectedCallback(),Te(),this._objectSelectorMonitor=new At(this,e=>{this._settingsValid=e},e=>{this._showErrors=e})}firstUpdated(e){this.updateComplete.then(async()=>{this._objectSelectorMonitor.startMonitoring();const e=await qe(),t=await Ce(null==e?void 0:e.shadowRoot,"hui-dialog-edit-card $ [slot='primaryAction']>ha-button:nth-child(2) $ button");null==t||t.addEventListener("click",this._handleClickAwayFromSettings.bind(this));const i=await Ce(null==e?void 0:e.shadowRoot,"hui-dialog-edit-card $ [slot='secondaryAction'] $ button");null==i||i.addEventListener("click",this._handleClickAwayFromSettings.bind(this))})}async getUpdateComplete(){const e=new Promise(e=>{const t=()=>{var i;const s=null===(i=this.shadowRoot)||void 0===i?void 0:i.querySelector("ha-form");s?e(s.updateComplete):setTimeout(t,100)};t()});return Promise.all([e,super.getUpdateComplete()]).then(()=>!0)}_handleClickAwayFromSettings(e){if(!this._settingsValid)return e.stopPropagation(),void this.dispatchEvent(new CustomEvent("hass-notification",{detail:{message:"Settings are not valid. Please fix the errors before\n              before continuing."},bubbles:!0,composed:!0}))}_handleSwitchTab(e){this._selectedTab="settings"==e.detail.name?0:1,1===this._selectedTab?this._objectSelectorMonitor.stopMonitoring():setTimeout(()=>this._objectSelectorMonitor.startMonitoring(),0)}_configChanged(e){e.stopPropagation(),this._config&&(this._config=Object.assign({},e.detail.value),this.dispatchEvent(new CustomEvent("config-changed",{detail:{config:this._config}})))}_cardConfigChanged(e){if(e.stopPropagation(),!this._config)return;const t=Object.assign({},e.detail.config);this._config=Object.assign(Object.assign({},this._config),{card:t}),this._cardGUIModeAvailable=e.detail.guiModeAvailable,this.dispatchEvent(new CustomEvent("config-changed",{detail:{config:this._config}}))}_toggleCardMode(e){var t;null===(t=this._cardEditorEl)||void 0===t||t.toggleMode()}_deleteCard(e){this._config&&(this._config=Object.assign({},this._config),delete this._config.card,this.dispatchEvent(new CustomEvent("config-changed",{detail:{config:this._config}})))}_cardGUIModeChanged(e){e.stopPropagation(),this._cardGUIMode=e.detail.guiMode,this._cardGUIModeAvailable=e.detail.guiModeAvailable}render(){return this.hass&&this._config?Y`
      <div class="card-config">
        <div class="toolbar">
          <ha-tab-group
            @wa-tab-show=${this._handleSwitchTab}
          >
            <ha-tab-group-tab slot="nav" .panel=${"settings"} .active=${0==this._selectedTab}>Settings</ha-tab-group-tab>
            <ha-tab-group-tab slot="nav" .panel=${"card"} .active=${1==this._selectedTab} @click=${this._handleClickAwayFromSettings}>Card</ha-tab-group-tab>
          </ha-tab-group>
        </div>
        <div id="editor">
          ${[this._renderSettingsEditor,this._renderCardEditor][this._selectedTab].bind(this)()}
        </div>
      </div>
    `:Y``}_renderSettingsEditor(){return Y`
    <ha-alert
      .hass=${this.hass}
      alert-type="info"
    >
      <ul>
        <li>Set <strong>Popup-card ID</strong> to use as a template for <code>browser_mod.popup</code></li>
        <li>Set <strong>Targets</strong> to use as a replacement for Home Assistant <code>more-info</code> dialog for entities matching selected targets.</li>
      </ul>
    </ha-alert>
    <div class="box">
      <ha-alert
        .hass=${this.hass}
        alert-type="error"
        .hidden=${!this._showErrors}
        >Settings are not valid. Please check the following fields for errors:
        <ul>
          ${this._objectSelectorMonitor.objectSelectors.map(e=>!1===e.isValid?Y`<li>${e.label}</li>`:"")}
        </ul>
      </ha-alert>
      <ha-form
        .hass=${this.hass}
        .data=${this._config}
        .schema=${this._getSchema()}
        .computeLabel=${e=>{var t;return null!==(t=e.label)&&void 0!==t?t:e.name}}
        @value-changed=${this._configChanged}
      ></ha-form>
    </div>`}_getSchema(){var e,t=It;this._config.entity||(t=t.filter(e=>"entity"!==e.name)),this._config.style||(t=t.filter(e=>"style"!==e.name)),this._config.size||(t=t.filter(e=>"size"!==e.name));const i=null===(e=this._config.popup_styles)||void 0===e?void 0:e.filter(e=>"all"!==e.style&&!qt.includes(e.style)).map(e=>e.style);return t.forEach(e=>{"Popup styles"===e.label&&e.schema.forEach(e=>{"initial_style"===e.name?e.selector.select.options=[...qt,...null!=i?i:[]]:"style_sequence"===e.name?e.selector.select.options=["initial",...qt,...null!=i?i:[]]:"popup_styles"===e.name&&(e.selector.object.fields.include_styles.selector.select.options=[...qt,...null!=i?i:[]])})}),t}_renderCardEditor(){return Y`
      <div class="box cards">
        ${this._config.card?Y`
              <div class="toolbar">
                <ha-button
                  appearance="plain"
                  @click=${this._toggleCardMode}
                  .disabled=${!this._cardGUIModeAvailable}
                  class="gui-mode-button"
                >
                  ${!this._cardEditorEl||this._cardGUIMode?"Show code editor":"Show visual editor"}
                </ha-button>
                <ha-button
                  appearance="plain"
                  @click=${this._deleteCard}
                >
                  Change card type
                </ha-button>
              </div>
              <hui-card-element-editor
                .hass=${this.hass}
                .lovelace=${this.lovelace}
                .value=${this._config.card}
                @config-changed=${this._cardConfigChanged}
                @GUImode-changed=${this._cardGUIModeChanged}
              ></hui-card-element-editor>
            `:Y`
              <hui-card-picker
                .hass=${this.hass}
                .lovelace=${this.lovelace}
                @config-changed=${this._cardConfigChanged}
              ></hui-card-picker>
            `}
      </div>
    `}static get styles(){return a`
      ha-tab-group {
        margin-bottom: 16px;
      }

      ha-tab-group-tab {
        flex: 1;
      }

      ha-tab-group-tab::part(base) {
        width: 100%;
        justify-content: center;
      }
    
      .box {
        margin-top: 8px;
        border: 1px solid var(--divider-color);
        padding: 12px;
      }
      .box .toolbar {
        display: flex;
        justify-content: flex-end;
        width: 100%;
        gap: 8px;
      }
      .gui-mode-button {
        margin-right: auto;
      }
    `}}t([ue()],Mt.prototype,"_config",void 0),t([he()],Mt.prototype,"lovelace",void 0),t([he()],Mt.prototype,"hass",void 0),t([ue()],Mt.prototype,"_selectedTab",void 0),t([ue()],Mt.prototype,"_cardGUIMode",void 0),t([ue()],Mt.prototype,"_cardGUIModeAvailable",void 0),t([ue()],Mt.prototype,"_settingsValid",void 0),t([ue()],Mt.prototype,"_showErrors",void 0),t([_e("hui-card-element-editor")],Mt.prototype,"_cardEditorEl",void 0),window.addEventListener("browser-mod-bootstrap",async e=>{for(e.stopPropagation();!window.browser_mod;)await new Promise(e=>setTimeout(e,1e3));await window.browser_mod.connectionPromise,customElements.get("popup-card-editor")||(customElements.define("popup-card-editor",Mt),window.customCards=window.customCards||[],window.customCards.push({type:"popup-card",name:"Popup card",preview:!1,description:"Use a popup-card with browser_mod.popup action or to replace the more-info dialog for given targets."}))});class kt extends ae{constructor(){super(...arguments),this.preview=!1}static getConfigElement(){return document.createElement("popup-card-editor")}static getStubConfig(e,t){return{title:"Custom popup",dismissable:!0,card:{type:"markdown",content:"This card can be used in browser_mod.popup service or to replace the more-info dialog"}}}setConfig(e){this._config=e,(async()=>{const t=await window.loadCardHelpers();this._element=await t.createCardElement(e.card),this._element.hass=this.hass,this._element.preview=this.preview})()}updated(e){super.updated(e),e.has("hass")&&this._element&&(this._element.hass=this.hass),e.has("preview")&&this._element&&(this._element.preview=this.preview)}getCardSize(){return 0}render(){var e,t,i,s,o,n;return this.setHidden(!this.preview),this.preview?Y` <ha-card>
      <div class="header">
        ${this._config.dismissable?Y`
              <ha-icon-button>
                <ha-icon 
                  .icon=${this._config.dismiss_icon||"mdi:close"}
                ></ha-icon>
              </ha-icon-button>
            `:""}
        <div class="main-title">${this._config.title}</div>
        ${this._config.icons?ft(this._config.icons,(e,t)=>{var i,s;return Y`
              <ha-icon-button
                .title=${null!==(i=e.title)&&void 0!==i?i:""}
                class=${yt(e.class)}
              >
                <ha-icon 
                  .icon=${null!==(s=e.icon)&&void 0!==s?s:""}
                >
                </ha-icon>
              </ha-icon-button>
            `}):this._config.icon?Y`
              <ha-icon-button
                .title=${null!==(e=this._config.icon_title)&&void 0!==e?e:""}
                class=${yt(this._config.icon_class)}
              >
                <ha-icon 
                  .icon=${this._config.icon}
                >
                </ha-icon>
              </ha-icon-button>
            `:""}
      </div>
      <div class="content">
        ${this._element}
      </div>
      <style>
        :host {
        ${yt(this._config.style)}
        ${null===(t=this._config.popup_styles)||void 0===t?void 0:t.map(e=>"all"==e.style?`${e.styles}`:"")}
      </style>
      ${void 0!==this._config.right_button||void 0!==this._config.left_button?Y`
            <footer class="mdc-dialog__actions">
              <span>
                ${void 0!==this._config.left_button?Y`
                      <ha-button
                        variant=${null!==(i=this._config.left_button_variant)&&void 0!==i?i:"brand"}
                        appearance=${null!==(s=this._config.left_button_appearance)&&void 0!==s?s:"plain"}
                      >${this._config.left_button}</ha-button>
                    `:""}
              </span>
              <span>
                ${void 0!==this._config.right_button?Y`
                      <ha-button
                        variant=${null!==(o=this._config.right_button_variant)&&void 0!==o?o:"brand"}
                        appearance=${null!==(n=this._config.right_button_appearance)&&void 0!==n?n:"plain"}
                      >${this._config.right_button}</ha-button>
                    `:""}
              </span>
            </footer>
          `:""}
    </ha-card>`:Y``}setHidden(e){this.hasAttribute("hidden")!==e&&(this.toggleAttribute("hidden",e),this.dispatchEvent(new Event("card-visibility-changed",{bubbles:!0,composed:!0})))}static get styles(){return a`
      ha-card {
        background-color: var(
          --popup-background-color,
          var(--ha-card-background, var(--card-background-color, white))
        );
      }
      .header {
        color: var(--primary-text-color);
        background-color: var(
          --popup-header-background-color,
          var(--popup-background-color, --sidebar-background-color)
        );
        display: var(--layout-horizontal_-_display, flex);
        flex-direction: var(--layout-horizontal_-_flex-direction, row);
        align-items: var(--layout-center_-_align-items);
        padding: 12px;
        font-size: var(--app-toolbar-font-size, 20px);
      }
      ha-icon-button > * {
        display: flex;
      }
      .main-title {
        flex: 1;
        font-size: var(--ha-font-size-xl);
        line-height: var(--ha-line-height-condensed);
        font-weight: var(--ha-font-weight-normal);
        padding: 10px 4px;
        min-width: 0;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .mdc-dialog__actions {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin: 0px;
        padding: 8px 16px 8px 24px;
        border-top: 1px solid var(--divider-color);
      }

      .content {
        padding: 8px 8px 20px 8px;
      }
    `}}t([he()],kt.prototype,"hass",void 0),t([ue()],kt.prototype,"_config",void 0),t([he({type:Boolean,reflect:!0})],kt.prototype,"preview",void 0),t([ue()],kt.prototype,"_element",void 0),window.addEventListener("browser-mod-bootstrap",async e=>{for(e.stopPropagation();!window.browser_mod;)await new Promise(e=>setTimeout(e,1e3));await window.browser_mod.connectionPromise,customElements.get("popup-card")||customElements.define("popup-card",kt);let t=new MutationObserver(e=>{for(const t of e)if("childList"===t.type){for(const e of t.removedNodes)e instanceof Element&&"hui-root"===e.localName&&(i=null);for(const e of t.addedNodes)e instanceof Element&&"hui-root"===e.localName&&(i=e)}}),i=await xe(document);t&&(null==i?void 0:i.parentNode)&&t.observe(i.parentNode,{childList:!0}),["popstate","location-changed"].forEach(e=>window.addEventListener(e,async e=>{i=await xe(document)})),window.addEventListener("hass-more-info",e=>{var t,s,o,n,r,a,l;if((null===(t=e.detail)||void 0===t?void 0:t.ignore_popup_card)||(null===(s=e.detail)||void 0===s?void 0:s.view)&&"info"!==(null===(o=e.detail)||void 0===o?void 0:o.view)||!(null===(n=e.detail)||void 0===n?void 0:n.entityId)&&!(null===(r=e.detail)||void 0===r?void 0:r.target)||!i)return;null===(a=e.detail)||void 0===a||a.entityId;const d=function(e,t){var i,s;const o=null===(i=null==e?void 0:e.lovelace)||void 0===i?void 0:i.config,n=null==e?void 0:e.hass;if(o&&n){let i=n.entities[t];i||(i={entity_id:t,area_id:void 0,device_id:void 0,labels:[]});const r=null!==(s=null==e?void 0:e._curView)&&void 0!==s?s:0;let a=Array.from(Array(o.views.length).keys());a.splice(r,1),a.unshift(r);for(const e of a){const t=o.views[e];if(t.cards)for(const s of t.cards){if(st(s,i,e,r))return it(s);if(s.cards)for(const t of s.cards)if(st(t,i,e,r))return it(t)}if(t.sections)for(const s of t.sections)if(s.cards)for(const t of s.cards){if(st(t,i,e,r))return it(t);if(t.cards)for(const s of t.cards)if(st(s,i,e,r))return it(s)}}}return null}(i,null===(l=e.detail)||void 0===l?void 0:l.entityId);if(d){e.stopPropagation(),e.preventDefault();let t=Object.assign({},d);delete t.card,setTimeout(()=>{var e,i;null===(e=window.browser_mod)||void 0===e||e.showMoreInfo("","",!1,!1,!0),null===(i=window.browser_mod)||void 0===i||i.service("popup",Object.assign({content:d.card},t))},10)}})});const Tt=(e,t)=>{const i=e._$AN;if(void 0===i)return!1;for(const e of i)e._$AO?.(t,!1),Tt(e,t);return!0},Pt=e=>{let t,i;do{if(void 0===(t=e._$AM))break;i=t._$AN,i.delete(e),e=t}while(0===i?.size)},Ot=e=>{for(let t;t=e._$AM;e=t){let i=t._$AN;if(void 0===i)t._$AN=i=new Set;else if(i.has(e))break;i.add(e),Rt(t)}};function jt(e){void 0!==this._$AN?(Pt(this),this._$AM=e,Ot(this)):this._$AM=e}function Bt(e,t=!1,i=0){const s=this._$AH,o=this._$AN;if(void 0!==o&&0!==o.size)if(t)if(Array.isArray(s))for(let e=i;e<s.length;e++)Tt(s[e],!1),Pt(s[e]);else null!=s&&(Tt(s,!1),Pt(s));else Tt(this,e)}const Rt=e=>{e.type==lt&&(e._$AP??=Bt,e._$AQ??=jt)};class Dt extends ct{constructor(){super(...arguments),this._$AN=void 0}_$AT(e,t,i){super._$AT(e,t,i),Ot(this),this.isConnected=e._$AU}_$AO(e,t=!0){e!==this.isConnected&&(this.isConnected=e,e?this.reconnected?.():this.disconnected?.()),t&&(Tt(this,e),Pt(this))}setValue(e){if((e=>void 0===e.strings)(this._$Ct))this._$Ct._$AI(e,this);else{const t=[...this._$Ct._$AH];t[this._$Ci]=e,this._$Ct._$AI(t,this,0)}}disconnected(){}reconnected(){}}class Lt{constructor(e){this.G=e}disconnect(){this.G=void 0}reconnect(e){this.G=e}deref(){return this.G}}class Ut{constructor(){this.Y=void 0,this.Z=void 0}get(){return this.Y}pause(){this.Y??=new Promise(e=>this.Z=e)}resume(){this.Z?.(),this.Y=this.Z=void 0}}const Ht=e=>!(e=>null===e||"object"!=typeof e&&"function"!=typeof e)(e)&&"function"==typeof e.then,Nt=1073741823;const Yt=dt(class extends Dt{constructor(){super(...arguments),this._$Cwt=Nt,this._$Cbt=[],this._$CK=new Lt(this),this._$CX=new Ut}render(...e){return e.find(e=>!Ht(e))??G}update(e,t){const i=this._$Cbt;let s=i.length;this._$Cbt=t;const o=this._$CK,n=this._$CX;this.isConnected||this.disconnected();for(let e=0;e<t.length&&!(e>this._$Cwt);e++){const r=t[e];if(!Ht(r))return this._$Cwt=e,r;e<s&&r===i[e]||(this._$Cwt=Nt,s=0,Promise.resolve(r).then(async e=>{for(;n.get();)await n.get();const t=o.deref();if(void 0!==t){const i=t._$Cbt.indexOf(r);i>-1&&i<t._$Cwt&&(t._$Cwt=i,t.setValue(e))}}))}return G}disconnected(){this._$CK.disconnect(),this._$CX.pause()}reconnected(){this._$CK.reconnect(this),this._$CX.resume()}});class Gt extends ae{connectedCallback(){var e;super.connectedCallback(),this._tileCardEntities=(null===(e=window.browser_mod)||void 0===e?void 0:e.browserEntities)||{},this.addEventListener("browser-mod-entities-update",e=>{var t;this._tileCardEntities=(null===(t=window.browser_mod)||void 0===t?void 0:t.browserEntities)||{}})}setConfig(e){this._config=e}firstUpdated(e){this.updateComplete.then(()=>{var e;null===(e=this._tileCardEditor)||void 0===e||e.then(async e=>{let t=null,i=0;for(;!t&&i<10;)t=await Ce(e,"$ ha-form $ ha-selector"),t||(await new Promise(e=>setTimeout(e,100)),i++);null==t||t.style.setProperty("display","none")})})}willUpdate(e){var t;e.has("_config")&&(null===(t=this._tileCardEditor)||void 0===t||t.then(e=>{this._tileCardConfig=Object.assign(Object.assign({},this._config),{entity:this._getEntity(this._config.entity)}),e._config=this._tileCardConfig}))}_getEntity(e){if(this._haveEntity(e)){const t=e.split(".")[1];return t&&this._tileCardEntities[t].enabled?this._tileCardEntities[t].entity_id:""}return""}_haveEntity(e){if(!e||!this._tileCardEntities)return!1;const t=e.split(".")[1];return!!t&&Object.keys(this._tileCardEntities).some(e=>e===t)}render(){if(!this._config)return V;const e=this._renderEntitySelect(),t=Y`<hui-tile-card-editor
        .hass=${this.hass}
        .config=${this._config}
        @config-changed=${this._tileCardConfigChanged}
      ></hui-tile-card-editor>`;return Y`
      <div class="entity-select">
        ${e}
      </div>
      <div class="tile-card-editor">
        ${t}
      </div>`}_renderEntitySelect(){const e=[{name:"entity",label:"Browser Entity",selector:{select:{mode:"dropdown",required:!0,sort:!0,options:Object.keys(this._tileCardEntities||{}).map(e=>({value:`browser_entities.${e}`,label:Be(Re(e.replace(/_/g," ")))}))}}}];return Y`<ha-form
      .hass=${this.hass}
      .schema=${e}
      .data=${this._config}
      .computeLabel=${e=>{var t;return null!==(t=e.label)&&void 0!==t?t:e.name}}
      @value-changed=${this._entityChanged}
    ></ha-form>`}_tileCardConfigChanged(e){e.stopPropagation(),this._config=Object.assign(Object.assign({},e.detail.config),{entity:this._config.entity}),this.dispatchEvent(new CustomEvent("config-changed",{detail:{config:this._config}}))}_entityChanged(e){var t;e.stopPropagation();const i=null===(t=e.detail.value)||void 0===t?void 0:t.entity;i&&i!==this._config.entity&&(this._config=Object.assign(Object.assign({},this._config),{entity:i}),this.dispatchEvent(new CustomEvent("config-changed",{detail:{config:this._config}})))}static get styles(){return a`
      .entity-select {
        margin-bottom: 24px;
      }
    `}}t([he()],Gt.prototype,"hass",void 0),t([ue()],Gt.prototype,"_config",void 0),t([ue()],Gt.prototype,"_tileCardEntities",void 0),t([ve("hui-tile-card-editor")],Gt.prototype,"_tileCardEditor",void 0);class Vt extends ae{constructor(){super(),this.preview=!1,this.connectedWhileHidden=!0,this._privilegedUser=!1,this._tileCard=window.loadCardHelpers().then(e=>e.createCardElement({type:"tile",entity:"sun.sun"})),this._tileCard.then(e=>{e.constructor.getConfigElement()}),this._entitiesResolved=!1}static getConfigElement(){return document.createElement("browser-mod-tile-card-editor")}static getStubConfig(e,t){return{entity:"browser_entities.browserID"}}get _registered(){var e,t;return null!==(t=null===(e=window.browser_mod)||void 0===e?void 0:e.registered)&&void 0!==t&&t}connectedCallback(){var e;super.connectedCallback(),this._tileCardEntities=(null===(e=window.browser_mod)||void 0===e?void 0:e.browserEntities)||{},this.addEventListener("browser-mod-entities-update",e=>{var t;this._tileCardEntities=(null===(t=window.browser_mod)||void 0===t?void 0:t.browserEntities)||{},this._replaceEntities()}),xe(document).then(e=>{var t,i,s,o;const n=null===(t=window.browser_mod)||void 0===t?void 0:t.user,r=null!==(o=null===(s=null===(i=null==e?void 0:e.config)||void 0===i?void 0:i.browser_mod)||void 0===s?void 0:s.privileged_users)&&void 0!==o?o:[];this._privilegedUser=(null==n?void 0:n.is_admin)||r.includes(null==n?void 0:n.name)||!1,this.requestUpdate()})}setConfig(e){e.browser_mod_tile||(this._config=tt(e),delete this._config.type)}getCardSize(){var e,t,i;const s=this._config&&this._featurePosition(this._config),o=(null===(t=null===(e=this._config)||void 0===e?void 0:e.features)||void 0===t?void 0:t.length)||0;return 1+((null===(i=this._config)||void 0===i?void 0:i.vertical)?1:0)+("inline"===s?0:o)}getGridOptions(){var e,t,i;let s=6,o=1;const n=this._config&&this._featurePosition(this._config),r=(null===(t=null===(e=this._config)||void 0===e?void 0:e.features)||void 0===t?void 0:t.length)||0;if(r&&("inline"===n?s=12:o+=r),(null===(i=this._config)||void 0===i?void 0:i.vertical)&&(o++,s=3),this.preview){this._computeCardError()&&(o=Math.max(2,o))}return{columns:6,rows:o,min_columns:s,min_rows:o}}_featurePosition(e){return e.vertical?"bottom":e.features_position||"bottom"}willUpdate(e){super.willUpdate(e),e.has("hass")&&this._tileCard&&this._tileCard.then(e=>e.hass=this.hass),e.has("preview")&&this._tileCard&&this._tileCard.then(e=>e.preview=this.preview),e.has("_config")&&(this._replaceEntities(),this._tileCard.then(e=>e.setConfig(this._config)))}_getEntity(e){if(this._haveEntity(e)){const t=e.split(".")[1];return t&&this._tileCardEntities[t].enabled?this._tileCardEntities[t].entity_id:null}return null}_haveEntity(e){if(!e||!this._tileCardEntities)return!1;const t=e.split(".")[1];return!!t&&Object.keys(this._tileCardEntities).some(e=>e===t)}_haveEntities(){return this._tileCardEntities&&Object.keys(this._tileCardEntities).length>0}_replaceEntities(){var e;if(!this._config||!this._haveEntities())return;const t=JSON.stringify(this._config).replace(/\b(browser_entities\.[\w.-]+)\b/g,e=>{var t;return null!==(t=this._getEntity(e))&&void 0!==t?t:e});this._entitiesResolved=!t.includes("browser_entities."),this._config=JSON.parse(t),this.parentElement&&!0!==(null===(e=this.parentElement.config)||void 0===e?void 0:e.browser_mod_tile_card)&&(this.parentElement.config=Object.assign(Object.assign({},this._config),{browser_mod_tile_card:!0,type:"custom:browser-mod-tile-card"}))}_handleErrorClick(){var e;null===(e=window.browser_mod)||void 0===e||e.service("browser_mod.change_browser_id",{})}_computeCardError(){return this._registered?this._haveEntities()?this._entitiesResolved?null:{severity:"warning",error:"Entity not enabled for this Browser",handleChangeId:!1}:{severity:"error",error:"Browser entities unavailable",handleChangeId:!0}:{severity:"warning",error:"Browser not registered",handleChangeId:!0}}render(){var e;if(!this._tileCard)return V;const t=this._computeCardError();if(t){const i=document.createElement("hui-error-card");return i.setConfig({severity:t.severity,error:t.error,message:`Entity: ${null===(e=this._config)||void 0===e?void 0:e.entity}`}),i.hass=this.hass,i.preview=this.preview,this._privilegedUser&&t.handleChangeId?(i.addEventListener("click",()=>this._handleErrorClick()),i.style.cursor="pointer"):i.style.cursor="default",Y`${i}`}return Y`${Yt(this._tileCard,Y`<span>Loading...</span>`)}`}}t([he()],Vt.prototype,"hass",void 0),t([ue()],Vt.prototype,"_config",void 0),t([he({type:Boolean,reflect:!0})],Vt.prototype,"preview",void 0),t([he({type:Boolean,reflect:!1})],Vt.prototype,"connectedWhileHidden",void 0),t([ue()],Vt.prototype,"_tileCardEntities",void 0),window.addEventListener("browser-mod-bootstrap",async e=>{for(e.stopPropagation();!window.browser_mod;)await new Promise(e=>setTimeout(e,1e3));await window.browser_mod.connectionPromise,customElements.get("browser-mod-tile-card-editor")||customElements.define("browser-mod-tile-card-editor",Gt),customElements.get("browser-mod-tile-card")||(customElements.define("browser-mod-tile-card",Vt),window.customCards.push({type:"browser-mod-tile-card",name:"Browser Mod Tile",preview:!0,description:"Provides access to local Browser Mod entities using a tile card."}))});const Qt={type:"entity",show_name:!1,show_state:!0,show_icon:!0};class zt extends ae{connectedCallback(){var e;super.connectedCallback(),this._badgeEntities=(null===(e=window.browser_mod)||void 0===e?void 0:e.browserEntities)||{},this.addEventListener("browser-mod-entities-update",e=>{var t;this._badgeEntities=(null===(t=window.browser_mod)||void 0===t?void 0:t.browserEntities)||{}})}setConfig(e){this._config=e}firstUpdated(e){this.updateComplete.then(()=>{var e;null===(e=this._badgeEditor)||void 0===e||e.then(async e=>{let t=null,i=0;for(;!t&&i<10;)t=await Ce(e,"$ ha-form $ ha-selector"),t||(await new Promise(e=>setTimeout(e,100)),i++);null==t||t.style.setProperty("display","none")})})}willUpdate(e){var t;e.has("_config")&&(null===(t=this._badgeEditor)||void 0===t||t.then(e=>{this._badgeConfig=Object.assign(Object.assign({},this._config),{entity:this._getEntity(this._config.entity)}),e._config=Object.assign(Object.assign({},Qt),this._badgeConfig)}))}_getEntity(e){if(this._haveEntity(e)){const t=e.split(".")[1];return t&&this._badgeEntities[t].enabled?this._badgeEntities[t].entity_id:""}return""}_haveEntity(e){if(!e||!this._badgeEntities)return!1;const t=e.split(".")[1];return!!t&&Object.keys(this._badgeEntities).some(e=>e===t)}render(){if(!this._config)return V;const e=this._renderEntitySelect(),t=Y`<hui-entity-badge-editor
        .hass=${this.hass}
        .config=${this._config}
        @config-changed=${this._badgeConfigChanged}
      ></hui-entity-badge-editor>`;return Y`
      <div class="entity-select">
        ${e}
      </div>
      <div class="badge-editor">
        ${t}
      </div>`}_renderEntitySelect(){const e=[{name:"entity",label:"Browser Entity",selector:{select:{mode:"dropdown",required:!0,sort:!0,options:Object.keys(this._badgeEntities||{}).map(e=>({value:`browser_entities.${e}`,label:Be(Re(e.replace(/_/g," ")))}))}}}];return Y`<ha-form
      .hass=${this.hass}
      .schema=${e}
      .data=${this._config}
      .computeLabel=${e=>{var t;return null!==(t=e.label)&&void 0!==t?t:e.name}}
      @value-changed=${this._entityChanged}
    ></ha-form>`}_badgeConfigChanged(e){e.stopPropagation(),this._config=Object.assign(Object.assign({},e.detail.config),{entity:this._config.entity}),this.dispatchEvent(new CustomEvent("config-changed",{detail:{config:this._config}}))}_entityChanged(e){var t;e.stopPropagation();const i=null===(t=e.detail.value)||void 0===t?void 0:t.entity;i&&i!==this._config.entity&&(this._config=Object.assign(Object.assign({},this._config),{entity:i}),this.dispatchEvent(new CustomEvent("config-changed",{detail:{config:this._config}})))}static get styles(){return a`
      .entity-select {
        margin-bottom: 24px;
      }
    `}}t([he()],zt.prototype,"hass",void 0),t([ue()],zt.prototype,"_config",void 0),t([ue()],zt.prototype,"_badgeEntities",void 0),t([ve("hui-entity-badge-editor")],zt.prototype,"_badgeEditor",void 0);class Ft extends ae{constructor(){super(),this.preview=!1,this.connectedWhileHidden=!0,this._privilegedUser=!1,this._badge=window.loadCardHelpers().then(e=>e.createBadgeElement({type:"entity",entity:"sun.sun"})),this._badge.then(e=>{e.constructor.getConfigElement()}),this._entitiesResolved=!1}static getConfigElement(){return document.createElement("browser-mod-badge-editor")}static getStubConfig(e,t){return{entity:"browser_entities.browserID"}}get _registered(){var e,t;return null!==(t=null===(e=window.browser_mod)||void 0===e?void 0:e.registered)&&void 0!==t&&t}connectedCallback(){var e;super.connectedCallback(),this._badgeEntities=(null===(e=window.browser_mod)||void 0===e?void 0:e.browserEntities)||{},this.addEventListener("browser-mod-entities-update",e=>{var t;this._badgeEntities=(null===(t=window.browser_mod)||void 0===t?void 0:t.browserEntities)||{},this._replaceEntities()}),xe(document).then(e=>{var t,i,s,o;const n=null===(t=window.browser_mod)||void 0===t?void 0:t.user,r=null!==(o=null===(s=null===(i=null==e?void 0:e.config)||void 0===i?void 0:i.browser_mod)||void 0===s?void 0:s.privileged_users)&&void 0!==o?o:[];this._privilegedUser=(null==n?void 0:n.is_admin)||r.includes(null==n?void 0:n.name)||!1,this.requestUpdate()})}setConfig(e){e.browser_mod_badge||(this._config=tt(e),delete this._config.type)}willUpdate(e){super.willUpdate(e),e.has("hass")&&this._badge&&this._badge.then(e=>e.hass=this.hass),e.has("preview")&&this._badge&&this._badge.then(e=>e.preview=this.preview),e.has("_config")&&(this._replaceEntities(),this._badge.then(e=>e.setConfig(this._config)))}_getEntity(e){if(this._haveEntity(e)){const t=e.split(".")[1];return t&&this._badgeEntities[t].enabled?this._badgeEntities[t].entity_id:null}return null}_haveEntity(e){if(!e||!this._badgeEntities)return!1;const t=e.split(".")[1];return!!t&&Object.keys(this._badgeEntities).some(e=>e===t)}_haveEntities(){return this._badgeEntities&&Object.keys(this._badgeEntities).length>0}_replaceEntities(){var e;if(!this._config||!this._haveEntities())return;const t=JSON.stringify(this._config).replace(/\b(browser_entities\.[\w.-]+)\b/g,e=>{var t;return null!==(t=this._getEntity(e))&&void 0!==t?t:e});this._entitiesResolved=!t.includes("browser_entities."),this._config=JSON.parse(t),this.parentElement&&!0!==(null===(e=this.parentElement.config)||void 0===e?void 0:e.browser_mod_badge)&&(this.parentElement.config=Object.assign(Object.assign({},this._config),{browser_mod_badge:!0,type:"custom:browser-mod-badge"}))}_handleErrorClick(){var e;null===(e=window.browser_mod)||void 0===e||e.service("browser_mod.change_browser_id",{})}_computeBadgeError(){return this._registered?this._haveEntities()?this._entitiesResolved?null:{severity:"warning",error:"Entity not enabled for this Browser",handleChangeId:!1}:{severity:"error",error:"Browser entities unavailable",handleChangeId:!0}:{severity:"warning",error:"Browser not registered",handleChangeId:!0}}render(){if(!this._badge)return V;const e=this._computeBadgeError();return e?Y`
        <ha-badge
        class=${e.severity}
        .type=${this._privilegedUser&&e.handleChangeId?"button":""}
        .hass=${this.hass}
        @click=${this._privilegedUser&&e.handleChangeId?()=>this._handleErrorClick():V}
        >
          <ha-icon slot="icon" icon="mdi:alert-circle"></ha-icon>
          <div class="content">${e.error}</div>
        </ha-badge>
      `:Y`${Yt(this._badge,Y`<span>Loading...</span>`)}`}static get styles(){return a`
      ha-badge.error {
        --badge-color: var(--ha-color-fill-danger-loud-resting, --error-color);
      }
      ha-badge.warning {
        --badge-color: var(--ha-color-fill-warning-loud-resting, --warning-color);
      }
    `}}t([he()],Ft.prototype,"hass",void 0),t([ue()],Ft.prototype,"_config",void 0),t([he({type:Boolean,reflect:!0})],Ft.prototype,"preview",void 0),t([he({type:Boolean,reflect:!1})],Ft.prototype,"connectedWhileHidden",void 0),t([ue()],Ft.prototype,"_badgeEntities",void 0),window.addEventListener("browser-mod-bootstrap",async e=>{for(e.stopPropagation();!window.browser_mod;)await new Promise(e=>setTimeout(e,1e3));await window.browser_mod.connectionPromise,customElements.get("browser-mod-badge-editor")||customElements.define("browser-mod-badge-editor",zt),customElements.get("browser-mod-badge")||(customElements.define("browser-mod-badge",Ft),window.customBadges=window.customBadges||[],window.customBadges.push({type:"browser-mod-badge",name:"Browser Mod Badge",preview:!0,description:"Provides access to local Browser Mod entities using a badge."}))});class Kt extends ae{constructor(e,t){super(),this.settings=e,this._actionCallback=t,this.show=""}set settings(e){var t,i,s,o;this.icon=null!==(t=null==e?void 0:e.icon)&&void 0!==t?t:"",this.title=null!==(i=null==e?void 0:e.title)&&void 0!==i?i:"",this.action=e.action,this.top=e.top,this.left=e.left,this.bottom=e.bottom,this.right=e.right,this.class=null!==(s=e.class)&&void 0!==s?s:"",this.userStyle=null!==(o=e.style)&&void 0!==o?o:""}actionCallback(e){var t;e.stopPropagation(),e.preventDefault(),this.blur(),null===(t=this._actionCallback)||void 0===t||t.call(this,this.action)}async connectedCallback(){super.connectedCallback(),await Promise.all([customElements.whenDefined("ha-icon-button"),customElements.whenDefined("ha-icon")])}_renderDynamicStyles(){let e=":host {\n";return void 0!==this.top&&(e+=`  top: ${this.top}px;\n`),void 0!==this.left&&(e+=`  left: ${this.left}px;\n`),void 0!==this.bottom&&(e+=`  bottom: ${this.bottom}px;\n`),void 0!==this.right&&(e+=`  right: ${this.right}px;\n`),e+="}\n\n",this.userStyle&&(e+=`\n${this.userStyle}`),e}render(){return void 0===!this.show?Y``:Y`
      <div class="browser-mod-overlay-icon">
        <ha-icon-button
          class=${this.class}
          .title=${this.title}
          @click=${this.actionCallback}
        >
          <ha-icon
            icon=${this.icon}
          ></ha-icon>
        </ha-icon-button>
        </ha-icon>
      </div>
      <style>
        ${this._renderDynamicStyles()}
      </style>
    `}static get styles(){return a`
      :host([show]) {
        display: block;
        position: fixed;
        z-index: 9999;
      }
      
      :host {
        display: none;
      }

      ha-icon {
        display: grid;
      }
    `}}t([he({reflect:!0})],Kt.prototype,"show",void 0),t([ue()],Kt.prototype,"icon",void 0),t([ue()],Kt.prototype,"title",void 0),t([ue()],Kt.prototype,"top",void 0),t([ue()],Kt.prototype,"left",void 0),t([ue()],Kt.prototype,"bottom",void 0),t([ue()],Kt.prototype,"right",void 0),t([ue()],Kt.prototype,"class",void 0),t([ue()],Kt.prototype,"userStyle",void 0),customElements.get("browser-mod-overlay-icon")||customElements.define("browser-mod-overlay-icon",Kt);const Wt="browser_mod-no-sidebar-edit-mode-prompt",Jt=[{label:"Browser Mod is installed. Edit sidebar settings with Browser Mod (recommended) or Continue to use the built-in editor.",type:"constant"},{name:"ignore_sidebar_edit_mode_prompt",label:"Do not show this prompt again",default:!1,selector:{boolean:{}}}],Zt=e=>{class i extends e{async runHideHeader(){for(;!await this._hideHeader();)await new Promise(e=>setTimeout(e,500))}async runUpdateTitle(){await async function(e,t,i){for(;t--;)await e(),await new Promise(e=>setTimeout(e,i))}(()=>this._updateTitle(),3,500)}async updateOverlayIcon(){this._updateOverlayIcon()}constructor(){super(),this._removeLegacySidebarSettings=!1,this.__currentTitle=void 0,this._overlayIcon=void 0;const e=async()=>{this.runUpdateTitle(),this.runHideHeader(),this.updateOverlayIcon()};new URLSearchParams(window.location.search).has("disableBrowserModFrontendSettings")?console.info("%cBROWSER_MOD FRONTEND SETTINGS DISABLED","color: black; background: yellow; font-weight: bold"):(this._auto_settings_setup(),this.addEventListener("browser-mod-config-update",()=>{this._auto_settings_setup(),e()}),this.addEventListener("browser-mod-user-ready",()=>{this._auto_settings_setup(),e()}),this.addEventListener("browser-mod-entities-update",()=>{this._auto_settings_setup(),e()}),window.addEventListener("location-changed",e),window.addEventListener("popstate",e),this.addEventListener("browser-mod-user-ready",()=>{this.entitiesReady().then(()=>{this._runDefaultAction()}).catch(e=>{console.warn(`Browser Mod: ${e}. Timeout waiting for browser entities to be ready. Default action not run.`)})},{once:!0}),this._watchEditSidebar())}async _auto_settings_setup(){await this.connectionPromise;const e=this.settings;e.sidebarPanelOrder?localStorage.setItem("sidebarPanelOrder",e.sidebarPanelOrder):this._removeLegacySidebarSettings&&localStorage.removeItem("sidebarPanelOrder"),e.sidebarHiddenPanels?localStorage.setItem("sidebarHiddenPanels",e.sidebarHiddenPanels):this._removeLegacySidebarSettings&&localStorage.removeItem("sidebarHiddenPanels"),e.defaultPanel&&localStorage.setItem("defaultPanel",`"${e.defaultPanel}"`),!0===e.kioskMode&&window.dispatchEvent(new CustomEvent("hass-kiosk-mode",{detail:{enable:!0}})),!0===e.hideSidebar&&Ce(document.body,"home-assistant").then(e=>{e.updateComplete.then(()=>{e.dispatchEvent(new CustomEvent("hass-dock-sidebar",{detail:{dock:"always_hidden"}}))})}),e.sidebarTitle&&(async()=>{this._sidebarTitleSubscription&&this._sidebarTitleSubscription(),this._sidebarTitleSubscription=void 0,this._sidebarTitleSubscription=await this.connection.subscribeMessage(this._updateSidebarTitle,{type:"render_template",template:e.sidebarTitle,variables:{browser_id:this.browserID,browser_entities:this.browserEntities}})})(),void 0!==e.faviconTemplate&&(async()=>{this._faviconTemplateSubscription&&this._faviconTemplateSubscription(),this._faviconTemplateSubscription=void 0,this._faviconTemplateSubscription=await this.connection.subscribeMessage(this._updateFavicon,{type:"render_template",template:e.faviconTemplate,variables:{browser_id:this.browserID,browser_entities:this.browserEntities}})})(),void 0!==e.titleTemplate&&(async()=>{this._titleTemplateSubscription&&this._titleTemplateSubscription(),this._titleTemplateSubscription=void 0,this._titleTemplateSubscription=await this.connection.subscribeMessage(this._updateTitle.bind(this),{type:"render_template",template:e.titleTemplate,variables:{browser_id:this.browserID,browser_entities:this.browserEntities}})})(),this._setupOverlayIcon()}async _updateSidebarTitle({result:e}){let t,i=0;for(;!t&&i++<5;)t=await Ce(document.body,"home-assistant $ home-assistant-main $ ha-drawer ha-sidebar $ .title"),t||await new Promise(e=>setTimeout(e,500));t&&(t.innerHTML=e)}get _currentFavicon(){const e=document.head.querySelector("link[rel~='icon']");return null==e?void 0:e.href}_updateFavicon({result:e}){document.head.querySelector("link[rel~='icon']").href=e}get _currentTitle(){return this.__currentTitle}_updateTitle(e=void 0){e&&(this.__currentTitle=e.result),this.__currentTitle&&(document.title=this.__currentTitle)}async _hideHeader(){var e,t,i;if(!0!==this.settings.hideHeader&&!0!==this.settings.hideSidebar)return!0;const s=await Ce(document.body,"home-assistant $ home-assistant-main $ ha-drawer partial-panel-resolver");if(!s)return!1;let o,n=await Ce(s,"ha-panel-lovelace$hui-root$.header");if(n)o=n.querySelector("ha-menu-button");else{let i=0,r=s;for(;r&&"ha-top-app-bar-fixed"!==r.localName&&i++<5;){await $e(r,!0);const i=null!==(t=null!==(e=r.querySelector("ha-top-app-bar-fixed"))&&void 0!==e?e:r.firstElementChild)&&void 0!==t?t:r.shadowRoot;r=i}if("ha-top-app-bar-fixed"!==(null==r?void 0:r.localName))return!1;n=r.shadowRoot.querySelector("header"),o=r.querySelector("ha-menu-button")}return n&&!0===this.settings.hideHeader?(s.style.setProperty("--header-height","0px"),n.style.setProperty("display","none"),!0):!(!o||!0!==this.settings.hideSidebar)&&(null===(i=o.remove)||void 0===i||i.call(o),!0)}_runDefaultAction(){if(this.settings.defaultAction){var e=this.settings.defaultAction;Array.isArray(e)||(e=[e]),e.forEach(async e=>{var{action:t,service:i,target:s,data:o}=e;i=void 0===t||"call-service"===t?i:t,this._service_action({service:i,target:s,data:o})})}}_runOverlayIconAction(e){if(e){var t=e;Array.isArray(t)||(t=[t]),t.forEach(async e=>{var{action:t,service:i,target:s,data:o}=e;i=void 0===t||"call-service"===t?i:t,this._service_action({service:i,target:s,data:o})})}}async _setupOverlayIcon(){var e;this.settings.overlayIcon?this._overlayIcon||(this._overlayIcon=new Kt(this.settings.overlayIcon,this._runOverlayIconAction.bind(this)),document.body.append(this._overlayIcon),this._updateOverlayIcon()):(null===(e=this._overlayIcon)||void 0===e||e.remove(),this._overlayIcon=void 0)}async _updateOverlayIcon(){var e,t,i;if(this.settings.overlayIcon&&this._overlayIcon){const s=null===(t=null===(e=window.location.pathname)||void 0===e?void 0:e.split("/"))||void 0===t?void 0:t[1];s&&((null===(i=this.settings.overlayIcon.panels)||void 0===i?void 0:i.includes(s))?this._overlayIcon.show="":this._overlayIcon.show=void 0)}}async _watchEditSidebar(){let e,t=0;for(;!e&&t++<10;)e=await Ce(document.body,"home-assistant $ home-assistant-main $ ha-drawer ha-sidebar"),e||await new Promise(e=>setTimeout(e,1e3));if(e&&void 0===e.editMode){const e=await Ce(document.body,"home-assistant $ home-assistant-main");e&&e.addEventListener("show-dialog",t=>{var i,s,o,n;if("dialog-edit-sidebar"===(null===(i=t.detail)||void 0===i?void 0:i.dialogTag)){if((null===(s=t.detail)||void 0===s?void 0:s.browser_mod_continue)||"true"===localStorage.getItem(Wt))return;if(t.stopPropagation(),(null===(o=this.hass.user)||void 0===o?void 0:o.is_admin)||!this.registered){const i=new CustomEvent("show-dialog",{bubbles:!0,composed:!0,detail:Object.assign({browser_mod_continue:!0},t.detail)});null===(n=window.browser_mod)||void 0===n||n.showPopup({title:"Edit sidebar",content:Jt,right_button:"Continue",right_button_action:t=>{localStorage.setItem(Wt,t.ignore_sidebar_edit_mode_prompt?"true":"false"),e.dispatchEvent(i)},right_button_variant:"brand",right_button_appearance:"plain",right_button_icon:"mdi:chevron-right",left_button:"Edit with Browser Mod",left_button_action:e=>{localStorage.setItem(Wt,e.ignore_sidebar_edit_mode_prompt?"true":"false"),this.browser_navigate("/browser-mod")},left_button_variant:"brand",left_button_appearance:"accent",style:"ha-dialog { position: fixed; z-index: 999; }"})}else{const e="browser_mod.notification",t="Sidebar settings are managed by owner/admin using Browser Mod integration.",i=5e3,s=!0;this.service(e,{message:t,duration:i,dismissable:s})}}}),this._removeLegacySidebarSettings=!0,this._auto_settings_setup()}}getSetting(e){var t,i,s,o;const n={global:void 0,browser:{},user:{}};if(!this._data)return n;n.global=null===(t=this._data.settings)||void 0===t?void 0:t[e];for(const[t,o]of Object.entries(null!==(i=this._data.browsers)&&void 0!==i?i:{}))null!=(null===(s=o.settings)||void 0===s?void 0:s[e])&&(n.browser[t]=o.settings[e]);for(const[t,i]of Object.entries(null!==(o=this._data.user_settings)&&void 0!==o?o:{}))null!=i[e]&&(n.user[t]=i[e]);return n}setSetting(e,t,i){if("global"===e)for(const[e,t]of Object.entries(i))this.connection.sendMessage({type:"browser_mod/settings",key:e,value:t});else if("browser"===e){const e=this._data.browsers[t],s=Object.assign(Object.assign({},e.settings),i);this.connection.sendMessage({type:"browser_mod/register",browserID:t,data:Object.assign(Object.assign({},e),{settings:s})})}else if("user"===e){const e=t;for(const[t,s]of Object.entries(i))this.connection.sendMessage({type:"browser_mod/settings",user:e,key:t,value:s})}}}return t([Pe()],i.prototype,"runHideHeader",null),t([Pe(!0)],i.prototype,"runUpdateTitle",null),t([Pe(!0)],i.prototype,"updateOverlayIcon",null),i},Xt="browser_mod-browser-id",ei="lovelace-player-device-id",ti=e=>class extends e{constructor(){if(super(),Storage&&!Storage.prototype.browser_mod_patched){const e=Storage.prototype.clear;Storage.prototype.clear=function(){const t=this.getItem(Xt),i=this.getItem("suspendWhenHidden");e.apply(this),this.setItem(Xt,t),this.setItem("suspendWhenHidden",i)},Storage.prototype.browser_mod_patched=!0}const e=window.location.search,t=new URLSearchParams(e).get("BrowserID");null!=t&&(this.browserID=t)}async recall_id(){if(!this.connection)return;const e=await this.connection.sendMessagePromise({type:"browser_mod/recall_id"});e&&(localStorage[Xt]=e)}get browserID(){return document.querySelector("hc-main")?"CAST":localStorage[Xt]?(localStorage[ei]=localStorage[Xt],localStorage[Xt]):(this.browserID="",this.recall_id(),this.browserID)}set browserID(e){""===e&&(e=function(){var e;const t=()=>Math.floor(1e5*(1+Math.random())).toString(16).substring(1);return"browser_mod_"+((null===(e=window.fully)||void 0===e?void 0:e.getDeviceId())?window.fully.getDeviceId().replace(/-/g,"_"):`${t()}${t()}_${t()}${t()}`)}());const t=localStorage[Xt];localStorage[Xt]=e,localStorage[ei]=localStorage[Xt],this.browserIDChanged(t,e)}browserIDChanged(e,t){}},ii=e=>class extends e{constructor(){super(),this._versionNotificationPending=!1,this._version=xt,this.addEventListener("browser-mod-ready",async()=>{await this._checkVersion()}),this.addEventListener("browser-mod-disconnected",()=>{this._notificationPending=!1})}async _checkVersion(){var e;(null===(e=this._data)||void 0===e?void 0:e.version)&&this._data.version!==this._version&&(this._versionNotificationPending||(this._versionNotificationPending=!0,await this._localNotification(this._data.version,this._version)))}async _localNotification(e,t){let i;do{await new Promise(e=>setTimeout(e,1e3)),i=await Ce(document.body,"home-assistant $ notification-manager $ ha-toast",!1,1e3)}while(i);const s={message:`Browser Mod version mismatch! Browser: ${t}, Home Assistant: ${e}`,duration:-1,dismissable:!0,action_text:"Reload",browser_id:"THIS",action:{service:"browser_mod.refresh",data:{browser_id:"THIS"}}};await this.service("browser_mod.notification",s)}},si=e=>class extends e{constructor(){super(),this._isUpdating=!1,this._getPanelNameTranslationKey=e=>"lovelace"===(null==e?void 0:e.url_path)?"panel.states":"profile"===(null==e?void 0:e.url_path)?"panel.profile":`panel.${null==e?void 0:e.title}`,["popstate","location-changed"].forEach(e=>{window.addEventListener(e,()=>setTimeout(()=>{this._panel_state_update()},1e3))}),["browser-mod-ready","browser-mod-popup-opened","browser-mod-popup-closed"].forEach(e=>{this.addEventListener(e,()=>setTimeout(()=>{this._panel_state_update()},1e3))}),this.connectionPromise.then(()=>this._panel_state_update())}async _getPanel(e){let t=await i(e);for(;null===t;)await new Promise(e=>setTimeout(e,100)),t=await i(e);return t;async function i(e){let t=await Ce(e,"home-assistant $ home-assistant-main $ partial-panel-resolver>*");return t||(t=await Ce(e,"hc-main $ hc-lovelace")),t||(t=await Ce(e,"hc-main $ hc-lovelace")),t}}_panelTitle(e){var t,i,s;if(null===(t=null==e?void 0:e.hass)||void 0===t?void 0:t.localize){const t=this._getPanelNameTranslationKey(e.panel);return e.hass.localize(t)||(null===(i=e.panel)||void 0===i?void 0:i.title)||""}return(null===(s=null==e?void 0:e.panel)||void 0===s?void 0:s.title)||""}_panelAttributes(e){var t,i,s,o,n;return{panelTitle:this._panelTitle(e),panelUrlPath:(null===(i=null===(t=null==e?void 0:e.route)||void 0===t?void 0:t.prefix)||void 0===i?void 0:i.replace(/^\/|\/$/g,""))||"",panelComponentName:(null===(s=null==e?void 0:e.panel)||void 0===s?void 0:s.component_name)||"",panelIcon:(null===(o=null==e?void 0:e.panel)||void 0===o?void 0:o.icon)||"",panelNarrow:(null==e?void 0:e.narrow)||!1,panelRequireAdmin:(null===(n=null==e?void 0:e.panel)||void 0===n?void 0:n.require_admin)||!1}}async _viewAttributes(e){var t,i,s,o,n,r,a,l,d,c;if("lovelace"!==(null===(t=null==e?void 0:e.panel)||void 0===t?void 0:t.component_name))return{viewTitle:"",viewUrlPath:(null===(s=null===(i=null==e?void 0:e.route)||void 0===i?void 0:i.path)||void 0===s?void 0:s.replace(/^\/|\/$/g,""))||"",viewNarrow:(null==e?void 0:e.narrow)||!1};let h=0;for(;!(null===(o=e.shadowRoot)||void 0===o?void 0:o.querySelector("hui-root"))&&h<10;)await new Promise(e=>setTimeout(e,1e3)),h++;const u=e.shadowRoot.querySelector("hui-root");if(!u)return{};const p=u._curView||0;return{viewTitle:(null===(a=null===(r=null===(n=u.config)||void 0===n?void 0:n.views)||void 0===r?void 0:r[p])||void 0===a?void 0:a.title)||"",viewUrlPath:(null===(c=null===(d=null===(l=u.config)||void 0===l?void 0:l.views)||void 0===d?void 0:d[p])||void 0===c?void 0:c.path)||`${p}`,viewNarrow:u.narrow}}_panel_state_update(){this._isUpdating||(async()=>{var e,t;this._isUpdating=!0;const i=await this._getPanel(document),s=this._panelAttributes(i),o=await this._viewAttributes(i),n=[];s.panelTitle&&n.push(s.panelTitle),o.viewTitle&&n.push(o.viewTitle);const r=[];s.panelUrlPath&&r.push(s.panelUrlPath),o.viewUrlPath&&r.push(o.viewUrlPath),this.sendUpdate({panel:{title:n.join(" - "),attributes:Object.assign(Object.assign(Object.assign({},s),o),{fullUrlPath:r.join("/"),popupOpen:null===(e=window.browser_mod)||void 0===e?void 0:e.popupState,openPopups:null===(t=window.browser_mod)||void 0===t?void 0:t.openPopups})}}),this._isUpdating=!1})()}};class oi extends(nt(ii($t(at(Qe(si(Ye(Ne(He(Zt(Ve(Ge(Le(ti(EventTarget))))))))))))))){constructor(){super(),this.connect(),window.dispatchEvent(new Event("browser-mod-bootstrap")),console.info(`%cBROWSER_MOD ${xt} IS INSTALLED\n    %cBrowserID: ${this.browserID}`,"color: green; font-weight: bold","")}}window.browser_mod||(window.browser_mod=new oi);export{oi as BrowserMod};
